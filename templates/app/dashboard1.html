{% extends "base.html" %} {% load static %} {% block title %} Dashboard {% endblock %} {% block content %}
<style type="text/css">
    /*.pen body {
    padding-top:50px;
}*/
    
    .ak1 {
        width: 100%;
        height: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        /* margin-top:-5%;*/
    }
    
    .one1 {
        width: 60%;
        min-height: fit-content;
        height: fit-content;
        margin-left: -4%;
    }
    
    .two2 {
        width: 34%;
        margin-left: -12%;
        display: flex;
        /* min-height: fit-content;
background-color: black;
border: 4px solid grey;
border-radius: 6px;*/
    }
    
     :root {
        font-size: calc(10px + 1vmin);
        --primary: hsl(45, 80%, 60%);
        --darkGrey: #333344;
        --mediumGrey: #557777;
        --softGrey: #9a97a8;
        --softTint: rgba(0, 0, 0, 0.2);
        --bounce: 0.3s cubic-bezier(0.3, -0.3, 0.1, 1.4);
        --ease: 0.5s cubic-bezier(0.3, 0.1, 0.3, 1);
        --length: 3;
    }
    
    *,
    *::before,
    *::after {
        margin: 0;
        padding: 0;
        color: inherit;
        line-height: inherit;
        text-decoration: none;
        list-style-type: none;
        /* box-sizing: border-box;
font-family: sans-serif;*/
    }
    /*body {
width: 90vw;
max-width: 50em;
margin: 10vh auto;
box-shadow: 1rem 1rem 3rem 0 var(--softTint);
line-height: 1.6;
color: var(--mediumGrey);
border-radius: 5px;
}*/
    
    h3 {
        color: var(--darkGrey);
    }
    
    input[type="radio"] {
        -webkit-appearance: none;
        font-size: .8rem;
        width: 1em;
        height: 1em;
        border-radius: 50%;
        outline-offset: .2em;
        border: 1px solid var(--softGrey);
    }
    
    input[type="radio"]:focus {
        outline: 1px solid var(--softTint);
    }
    
    input[type="radio"]:checked {
        background: var(--softGrey);
        box-shadow: inset 0 0 0 2px white;
    }
    
    .nav {
        display: flex;
        position: relative;
        overflow: hidden;
    }
    
    .nav label {
        flex-grow: 1;
        padding: .5rem;
        text-align: center;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--softGrey);
        transition: var(--bounce);
        cursor: pointer;
    }
    
    .nav::after {
        content: "";
        display: block;
        position: absolute;
        width: calc(100% / var(--length));
        height: 100%;
        /* border-bottom: 5px solid var(--primary);*/
        transform: translateX(calc(100% * var(--i)));
        transition: var(--bounce);
    }
    
    iframe {
        width: 100%;
        height: 50vh;
    }
    
    .erazor {
        border-radius: 6px;
        width: 100%;
        height: 7vh;
        border: 2px solid grey;
        padding: 2% 1%;
        padding-top: 7%;
        cursor: pointer;
    }
    
    .erazor::hover {
        content: 'erasor';
    }
    
    .outer-wrapper {
        /* display: inline-block;
margin: 5px 15px;
padding: 25px 15px;*/
        background: #eee;
        /* min-width: 50px;*/
    }
    
    .column-wrapper {
        height: 370px;
        width: 20px;
        background: #CFD8DC;
        transform: rotate(180deg);
        margin: 0 auto;
    }
    
    .column {
        /*//position: relative;
//display: block;
//bottom: 0;*/
        width: 20px;
        height: 0%;
        background: #90A4AE;
        /* //transfrom: -moz-translateY(-10px);*/
    }
    
    .percentage,
    .value {
        margin-top: 10px;
        margin-left: 5%;
        padding: 5px 10px;
        /*color: #FFF;*/
        /*background: #263238;*/
        position: relative;
        border-radius: 4px;
        text-align: center;
    }
    
    .value {
        background: #7986CB;
    }
    
    #meter {
        /* margin: 0 auto 4.5em; */
        width: 100%;
        height: 50px;
        display: block;
        margin-left: 7%;
    }
    
    @import url("https://fonts.googleapis.com/css?family=Nunito:400,900|Montserrat|Roboto");
    /*body {
background: linear-gradient(to right, #000000, #777777);
}*/
    
    .containers {
        background: #060606d6;
        width: 364px;
        flex-basis: 300px;
        height: calc(100vh - 30px);
        margin: 0 auto;
        position: relative;
        margin-top: 10%;
        border-radius: 6px;
        box-shadow: 2px 5px 20px 2px 5px 20px rgb(119, 119, 119);
    }
    
    .CTA {
        width: 80px;
        height: 40px;
        right: -20px;
        bottom: 0;
        margin-bottom: 90px;
        position: absolute;
        z-index: 1;
        background: #777777;
        font-size: 1em;
        transform: rotate(-90deg);
        transition: all .5s ease-in-out;
        cursor: pointer;
    }
    
    .CTA h1 {
        color: #FFFFFF;
        margin-top: 10px;
        margin-left: 9px;
    }
    
    .CTA:hover {
        background: #000000;
        transform: scale(1.1);
    }
    
    .leftbox {
        float: left;
        top: 3%;
        /* left: 2%; */
        position: absolute;
        width: 15%;
        height: 94%;
        background-image: url(/static/img/chesspieces/board/lapis/lapis1.png);
        box-shadow: 3px 3px 10px rgba(119, 119, 119, 0.5);
        display: none;
    }
    
    nav a {
        list-style: none;
        padding: 27px;
        color: #FFFFFF;
        font-size: 1.1em;
        display: block;
        transition: all .3s ease-in-out;
    }
    
    nav a:hover {
        /*color: #000000;*/
        transform: scale(1.2);
        cursor: pointer;
    }
    
    nav a:first-child {
        margin-top: 7px;
    }
    
    .active {
        color: black;
    }
    
    .rightbox {
        /* float: right; */
        width: 60%;
        margin-left: 18%;
        height: 100%;
    }
    
    .profile,
    .payment,
    .subscription,
    .privacy,
    .settings {
        transition: opacity .5s ease-in;
        position: absolute;
        width: 70%;
    }
    
    h1 {
        font-family: "Montserrat", sans-serif;
        color: #777777;
        font-size: 1.8em;
        /* margin-top: 40px; */
        font-weight: bolder;
        margin-bottom: 35px;
    }
    /*h2 {
color: #777777;
font-family: "Roboto", sans-serif;
width: 80%;
text-transform: uppercase;
font-size: 8px;
letter-spacing: 1px;
margin-left: 2px;
}*/
    /*p {
border-width: 1px;
border-style: solid;
border-image: linear-gradient(to right, #000000, rgba(119, 119, 119, 0.5)) 1 0%;
border-top: 0;
width: 80%;
font-family: "Montserrat", sans-serif;
font-size: .7em;
padding: 7px 0;
color: #000000;
}*/
    
    .btn {
        float: right;
        font-family: "Roboto", sans-serif;
        text-transform: uppercase;
        font-size: 10px;
        border: none;
        color: #8c8a88;
    }
    
    .btn:hover {
        text-decoration: none;
        font-weight: 900;
    }
    
    label {
        font-family: "Roboto", sans-serif;
        color: #8c8a88;
    }
    
    input {
        font-family: "Roboto", sans-serif;
        padding: 2px;
        margin: 0;
    }
    
    .privacy h2 {
        margin-top: 25px;
    }
    
    .settings h2 {
        margin-top: 25px;
    }
    
    .noshow {
        opacity: 0;
    }
    
    footer {
        position: absolute;
        width: 20%;
        bottom: 0;
        right: -20px;
        text-align: right;
        font-size: 0.8em;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-family: "Roboto", sans-serif;
    }
    
    footer p {
        border: none;
        padding: 0;
    }
    
    footer a {
        color: #ffffff;
        text-decoration: none;
    }
    
    footer a:hover {
        color: #7d7d7d;
    }
    
    .Hide {
        display: none;
    }
    
    .p1 {
        margin-left: -25% !important;
    }
    
    .nava {
        list-style: none;
        padding: 4px !important;
        padding-top: 187% !important;
        color: #FFFFFF;
        font-size: 2.1em !important;
    }
    
    .options {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
    }
    
    .op {
        width: 100%;
        padding-top: 21%;
        /* background-color: black; */
        padding-top: 94%;
        height: fit-content;
        cursor: pointer;
        color: white;
    }
    
    .bk {
        /* background-color: red;*/
        font-weight: bolder;
        height: fit-content;
        width: 100%;
    }
    
    h5 {
        font-size: 16px;
        font-weight: bold;
        color: #8c8a88;
    }
    
    .input-icon-wrap {
        border: 4px solid #244251;
        display: flex;
        border-radius: 6px;
        flex-direction: row;
        margin-top: 1%;
        width: 91%;
    }
    
    .input-icon {
        background: #244251;
    }
    
    .input-with-icon {
        border: none;
        flex: 1;
    }
    
    .input-icon,
    .input-with-icon {
        padding: 10px;
        color: white;
    }
    
    .arrows {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
    }
    
    .ar {
        width: 18%;
        cursor: pointer;
    }
    
    .draw-border {
        box-shadow: inset 0 0 0 3px #ecc023;
        transition: color 0.25s 0.0833333333s;
        position: relative;
    }
    
    .draw-border::before,
    .draw-border::after {
        border: 0 solid transparent;
        box-sizing: border-box;
        content: '';
        pointer-events: none;
        position: absolute;
        width: 0;
        height: 0;
        bottom: 0;
        right: 0;
    }
    
    .draw-border::before {
        border-bottom-width: 3px;
        border-left-width: 3px;
    }
    
    .draw-border::after {
        border-top-width: 3px;
        border-right-width: 3px;
    }
    
    .draw-border:hover {
        color: #ecc023;
    }
    
    .draw-border:hover::before,
    .draw-border:hover::after {
        border-color: #ecc023;
        transition: border-color 0s, width 0.25s, height 0.25s;
        width: 100%;
        height: 100%;
    }
    
    .draw-border:hover::before {
        transition-delay: 0s, 0s, 0.25s;
    }
    
    .draw-border:hover::after {
        transition-delay: 0s, 0.25s, 0s;
    }
    
    .btn {
        background: none;
        border: none;
        cursor: pointer;
        line-height: 1.5;
        color: #8c8a88;
        padding: 1em 1em;
        letter-spacing: 0.05rem;
    }
    
    .import {
        display: inline-flex;
        padding: 4%;
    }
    
    .boardStyle {
        display: flex;
        flex-direction: row;
    }
    
    .form-control {
        display: block;
        width: 100%;
        height: 34px;
        padding: 6px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        color: #8c8a88;
        background-color: #111;
        background-image: none;
        border: 2px solid;
        border-radius: 4px;
        -webkit-box-shadow: none;
        box-shadow: none;
        -webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
        -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
        transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    }
    
    .HIDE {
        display: none;
    }
    
    .pgn {
        height: 20vh;
        overflow: auto;
        width: 100%;
        text-align: left;
    }
    /* .overlay-4fc5e {
pointer-events: none;
position: absolute;
z-index: 10;
opacity: 1.0;
fill: #efb700;
stroke: #efb700;
} */
    
    .overlay-4fc5e {
        pointer-events: none;
        position: absolute;
        z-index: 10;
        opacity: 1.0;
        fill: #efb700;
        stroke: #efb700;
        margin-left: -40%;
        margin-top: 0%;
        width: 100%;
    }
    
    .overlay-4fc5e defs {
        stroke: none;
    }
    
    .overlay-group-672a1 {
        opacity: 0.7;
        stroke-linecap: square;
        stroke-linejoin: round;
        marker-end: url(#arrowhead);
        marker-start: url(#bulb);
        fill: none;
    }
    
    .highlight-white {
        box-shadow: inset 0 0 3px 3px yellow;
        fill: #efb700;
        stroke: #efb700;
    }
    
    .highlight-black {
        box-shadow: inset 0 0 3px 3px blue;
    }
    
    #contain {
        position: relative;
        width: 100%;
        height: fit-content;
    }
    
    #imageView {
        top: 0%;
        left: 0%;
        position: absolute;
        margin-top: 0%;
        z-index: 111;
    }
    
    #board {
        z-index: 11;
    }
    
    #imageTemp {
        z-index: 1111;
        position: absolute;
        top: 1px;
        left: 0px;
        display: none;
    }
    
    .button {
        position: relative;
        top: 50%;
        width: 74px;
        height: 36px;
        margin: -20px auto 0 auto;
        overflow: hidden;
    }
    
    .button.r,
    .button.r .layer {
        border-radius: 100px;
    }
    
    .button.b2 {
        border-radius: 2px;
    }
    
    .checkbox {
        position: relative;
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        opacity: 0;
        cursor: pointer;
        z-index: 3;
    }
    
    .knobs {
        z-index: 2;
    }
    
    .layer {
        width: 100%;
        background-color: #ebf7fc;
        transition: 0.3s ease all;
        z-index: 1;
    }
    /* Button 1 */
    
    #button-1 .knobs:before {
        content: '';
        position: absolute;
        top: 4px;
        left: 4px;
        width: 20px;
        height: 10px;
        color: #fff;
        font-size: 10px;
        font-weight: bold;
        text-align: center;
        line-height: 1;
        padding: 9px 4px;
        background-color: grey;
        border-radius: 50%;
        transition: 0.3s cubic-bezier(0.18, 0.89, 0.35, 1.15) all;
    }
    
    #button-1 .checkbox:checked+.knobs:before {
        content: '';
        left: 42px;
        background-color: green;
    }
    
    #button-1 .checkbox:checked~.layer {
        background-color: grey;
    }
    
    #button-1 .knobs,
    #button-1 .knobs:before,
    #button-1 .layer {
        transition: 0.3s ease all;
    }
    
    .overlay {
        position: fixed;
        top: 0;
        bottom: 0;
        z-index: 1111111;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.7);
        transition: opacity 500ms;
        visibility: hidden;
        opacity: 0;
    }
    
    .overlay:target {
        visibility: visible;
        opacity: 1;
    }
    
    .popup {
        margin: 70px auto;
        padding: 20px;
        background: #fff;
        border-radius: 5px;
        width: 30%;
        height: 30%;
        position: relative;
        transition: all 5s ease-in-out;
    }
    
    .popup h2 {
        margin-top: 0;
        color: #333;
        font-family: Tahoma, Arial, sans-serif;
    }
    
    .popup .close {
        position: absolute;
        top: 20px;
        right: 30px;
        transition: all 200ms;
        font-size: 30px;
        font-weight: bold;
        text-decoration: none;
        color: #333;
    }
    
    .popup .close:hover {
        color: #06D85F;
    }
    
    .popup .content1 {
        max-height: 100%;
        overflow: auto;
    }
    
    @media screen and (max-width: 700px) {
        .box {
            width: 70%;
        }
        .popup {
            width: 70%;
        }
    }
    
    .wrapper1 {
        margin: -18px auto;
        display: flex;
        flex-wrap: wrap;
        width: 100%;
    }
    
    .progress-bar1 {
        height: 35px;
        margin: 30px auto;
        background: black;
        padding: 2px;
        width: 99%;
    }
    
    .progress1 {
        height: 100%;
        background-size: 12000px 1px;
        background-color: white;
    }
    
    .container {
        display: flex;
        flex-direction: row-reverse;
        width: 100%;
        height: 100%;
    }
    
    .sidebar1 {
        background: #000;
        height: 100%;
        width: 18%;
        transition: all .3s ease-out;
    }
    
    .content.is-collapsed {
        flex: 0;
        background: white;
    }
    
    .content {
        flex: 3;
        width: 23%;
        position: fixed;
        margin-left: -.65%;
        flex-basis: 300px;
        height: calc(100vh - 30px);
        transition: all .3s ease-out;
        background-color: #222222;
        color: #8c8a88;
        /* box-shadow: 0 19px 38px rgba(0, 0, 0, 0.30), 0 15px 12px rgba(0, 0, 0, 0.22); */
        border-bottom: solid;
    }
    
    .tg-list {
        text-align: center;
        display: flex;
        align-items: center;
    }
    
    .tg-list-item {
        margin: 0 0;
    }
    
    .tgl {
        display: none;
    }
    
    .tgl,
    .tgl:after,
    .tgl:before,
    .tgl *,
    .tgl *:after,
    .tgl *:before,
    .tgl+.tgl-btn {
        box-sizing: border-box;
    }
    
    .tgl::-moz-selection,
    .tgl:after::-moz-selection,
    .tgl:before::-moz-selection,
    .tgl *::-moz-selection,
    .tgl *:after::-moz-selection,
    .tgl *:before::-moz-selection,
    .tgl+.tgl-btn::-moz-selection {
        background: none;
    }
    
    .tgl::selection,
    .tgl:after::selection,
    .tgl:before::selection,
    .tgl *::selection,
    .tgl *:after::selection,
    .tgl *:before::selection,
    .tgl+.tgl-btn::selection {
        background: none;
    }
    
    .tgl+.tgl-btn {
        outline: 0;
        display: block;
        width: 3em;
        height: 1.5em;
        position: relative;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    
    .tgl+.tgl-btn:after,
    .tgl+.tgl-btn:before {
        position: relative;
        display: block;
        content: "";
        width: 50%;
        height: 100%;
    }
    
    .tgl+.tgl-btn:after {
        left: 0;
    }
    
    .tgl+.tgl-btn:before {
        display: none;
    }
    
    .tgl:checked+.tgl-btn:after {
        left: 50%;
    }
    
    .tgl-light+.tgl-btn {
        background: #f0f0f0;
        border-radius: 2em;
        padding: 2px;
        transition: all .4s ease;
    }
    
    .tgl-light+.tgl-btn:after {
        border-radius: 50%;
        background: #fff;
        transition: all .2s ease;
    }
    
    .tgl-light:checked+.tgl-btn {
        background: #9FD6AE;
    }
    
    .tgl-ios+.tgl-btn {
        background: #fbfbfb;
        border-radius: 2em;
        padding: 2px;
        transition: all .4s ease;
        border: 1px solid #e8eae9;
    }
    
    .tgl-ios+.tgl-btn:after {
        border-radius: 2em;
        background: #fbfbfb;
        transition: left 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), padding 0.3s ease, margin 0.3s ease;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 4px 0 rgba(0, 0, 0, 0.08);
    }
    
    .tgl-ios+.tgl-btn:hover:after {
        will-change: padding;
    }
    
    .tgl-ios+.tgl-btn:active {
        box-shadow: inset 0 0 0 2em #e8eae9;
    }
    
    .tgl-ios+.tgl-btn:active:after {
        padding-right: .8em;
    }
    
    .tgl-ios:checked+.tgl-btn {
        background: #86d993;
    }
    
    .tgl-ios:checked+.tgl-btn:active {
        box-shadow: none;
    }
    
    .tgl-ios:checked+.tgl-btn:active:after {
        margin-left: -.8em;
    }
    
    hr.new1 {
        border-top: 1px solid #c19f21;
    }
    
    hr {
        margin-top: 0px;
        margin-bottom: 8px;
        border: 0;
        border-top: 1px solid #eee;
    }
    
    .nav1 {
        display: block;
        font: 13px Helvetica, Tahoma, serif;
        text-transform: uppercase;
        margin: 0;
        padding: 0;
    }
    
    .nav1 .li {
        display: inline-block;
        list-style: none;
        margin-left: -2%;
    }
    
    .nav1 .button-dropdown {
        position: relative;
    }
    
    .nav1 li a {
        display: block;
        color: #333;
        margin-left: -20%;
        padding: 10px 20px;
        text-decoration: none;
    }
    
    .nav1 .li a span {
        display: inline-block;
        margin-left: 5px;
        font-size: 10px;
        color: #999;
    }
    
    .nav1 .li a:hover,
    .nav1 .li a.dropdown-toggle.active {
        color: #fff;
    }
    
    .nav1 .li a:hover span,
    .nav1 .li a.dropdown-toggle.active span {
        color: #fff;
    }
    
    .dropdown-menu {
        background-color: transparent !important;
    }
    
    .nav1 .li .dropdown-menu {
        display: none;
        position: absolute;
        left: 0;
        padding: 0;
        margin: 0;
        margin-top: 3px;
        text-align: left;
    }
    
    .nav1 li .dropdown-menu.active {
        display: block;
    }
    
    .nav1 li .dropdown-menu a {
        width: 150px;
    }
    
    .modal.right .modal-dialog {
        -webkit-transform: translate3d(0%, 0, 0);
        -ms-transform: translate3d(0%, 0, 0);
        -o-transform: translate3d(0%, 0, 0);
        transform: translate3d(0%, 0, 0);
    }
    /*Right*/
    
    .modal.right.fade .modal-dialog {
        right: -420px;
        -webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
        -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
        -o-transition: opacity 0.3s linear, right 0.3s ease-out;
        transition: opacity 0.3s linear, right 0.3s ease-out;
    }
    
    .modal.right.fade.in .modal-dialog {
        right: 0;
    }
    /* ----- MODAL STYLE ----- */
    
    .modal-content {
        border-radius: 0;
        border: none;
        background-color: #111;
    }
    
    .modal-header {
        border-bottom-color: #EEEEEE;
        background-color: #111;
        color: #8c8a88;
    }
    
    .close {
        color: #8c8a88;
    }
    
    @import url("//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css");
    .menu,
    .menu-bar {
        position: fixed;
        top: 7px;
        left: 93.5%;
        height: 100%;
        list-style-type: none;
        margin: 0;
        flex-basis: 300px;
        height: calc(100vh - 30px);
        padding: 0;
        background: #222222;
        z-index: 10;
        overflow: hidden;
        box-shadow: 2px 0 14px rgb(0, 0, 0);
    }
    
    .menu li a {
        display: block;
        text-indent: -500em;
        height: 5em;
        width: 4em;
        line-height: 5em;
        text-align: center;
        color: #72739f;
        position: relative;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        transition: background 0.1s ease-in-out;
    }
    
    .menu li a:before {
        font-family: FontAwesome;
        text-indent: 0em;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        font-size: 1.4em;
    }
    
    .menu li a.search:before {
        content: "\f0eb";
    }
    
    .menu li a.archive:before {
        content: "\f079";
    }
    
    .menu li a.pencil:before {
        content: "\f01e";
    }
    
    .menu li a.contact:before {
        content: "\f013";
    }
    
    .menu li a.about:before {
        content: "\f019";
    }
    
    .menu li a.home:before {
        content: "\f039";
    }
    
    .menu li a.ar_analysis:before {
        content: "\f0b2";
    }
    
    .menu-bar li a:hover,
    .menu li a:hover,
    .menu li:first-child a {
        background: #ecc023;
        color: #fff;
    }
    
    .menu-bar {
        overflow: hidden;
        left: 69em;
        z-index: 5;
        width: 0;
        height: 0;
        transition: all 0.1s ease-in-out;
    }
    
    .menu-bar li a {
        display: block;
        height: 4em;
        margin-top: -3.5%;
        line-height: 4em;
        text-align: center;
        color: #72739f;
        text-decoration: none;
        position: relative;
        font-family: verdana;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        transition: background 0.1s ease-in-out;
    }
    
    .menu-bar li:first-child a {
        height: 5em;
        background: #267fdd;
        color: #fff;
        line-height: 5
    }
    
    .para {
        color: #033f72;
        padding-left: 100px;
        font-size: 3em;
        margin-bottom: 20px;
    }
    
    .open {
        width: 10em;
        height: 100%;
    }
    
    @media all and (max-width: 500px) {
        .container {
            margin-top: 100px;
        }
        .menu {
            height: 5em;
            width: 100%;
        }
        .menu li {
            display: inline-block;
            float: left;
        }
        .menu-bar li a {
            width: 100%;
        }
        .menu-bar {
            width: 100%;
            left: 0;
            height: 0;
        }
        .open {
            width: 100%;
            height: auto;
        }
        .para {
            padding-left: 5px;
        }
    }
    
    @media screen and (max-height: 34em) {
        .menu li,
        .menu-bar {
            font-size: 70%;
        }
    }
    
    @media screen and (max-height: 34em) and (max-width: 500px) {
        .menu {
            height: 3.5em;
        }
    }
    
    .nav1 {
        margin: 100px auto 0 auto;
        opacity: 0;
        visibility: hidden;
        border-radius: 4px;
        -webkit-transition: .2s ease-out;
        transition: .2s ease-out;
        -webkit-transform: translateY(-50px) scale(0.5);
        transform: translateY(-50px) scale(0.5);
        -webkit-transition: .2s;
        transition: .2s;
    }
    
    .nav1 a {
        text-decoration: none;
        color: #fff;
        display: block;
        padding: 15px 0;
        text-align: center;
    }
    
    .nav1 a:hover {
        background: #414141;
        -webkit-transition: 0.2s ease;
        transition: 0.2s ease;
    }
    
    #check {
        display: none;
    }
    
    #check:checked~nav {
        opacity: 1;
        visibility: visible;
        -webkit-transform: translateY(0);
        transform: translateY(0);
        -webkit-transform: translateY(0) scale(1);
        transform: translateY(0) scale(1);
        -webkit-transition: .2s;
        transition: .2s;
    }
    
    #check:checked~label {
        -webkit-transform: scale(1.1);
        transform: scale(1.1);
    }
    
    .ul {
        list-style: none;
        margin: 0;
        padding: 0;
        width: 150px;
    }
    
    .toolbar {
        width: 10%;
    }
    /* Vertical toolbar */
    
    @import url("//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css");
    .toolbar-vertical {
        top: 50px;
        width: 60px;
        right: 0;
        /* flex-basis: 300px; */
        height: calc(100vh - 30px);
        background-color: #222222;
        margin: 0;
        box-shadow: 0px 0 6px rgb(0, 0, 0);
        padding-top: 10px;
        padding-bottom: 6px;
        border-radius: 0 0 0 6px;
        z-index: 1;
        display: none;
    }
    
    .btn-group {
        margin-right: 2px;
    }
    
    .btn-group-vertical {
        margin-bottom: 6px;
    }
    
    .glyphicon {
        margin-top: 4px;
        margin-bottom: 6px;
        font-size: 2em;
    }
    
    .btn>.caret {
        margin-left: 4px;
    }
    
    .btn-default {
        color: #333;
        background-color: #fff;
        border-color: #ccc;
        border: 4px solid;
        border-radius: 6px;
    }
    
    .btn-toolbar {
        display: block;
        flex-wrap: initial;
        justify-content: safe;
    }
    
    .btn-group-vertical>.btn:first-child:not(:last-child) {
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
    }
    
    .btn-group-vertical>.btn,
    .btn-group-vertical>.btn-group,
    .btn-group-vertical>.btn-group>.btn {
        display: block;
        float: none;
        width: 100%;
        max-width: 100%;
        border-radius: 6px;
    }
    
    .btn-toolbar .btn,
    .btn-toolbar .btn-group,
    .btn-toolbar .input-group {
        float: left;
    }
    
    .btn-group-vertical>.btn,
    .btn-group>.btn {
        position: relative;
        float: left;
    }
    
    .btn-default {
        color: #333;
        background-color: #fff;
        border-color: #ccc;
        border-radius: 6px;
    }
    
    #wrap:-webkit-full-screen {
        max-width: none;
        /* overide pre-existing margin styles */
    }
    
    #board:-moz-full-screen {
        max-width: none;
        /* overide pre-existing margin styles */
    }
    
    #board:-ms-fullscreen {
        max-width: none;
    }
</style>
<article id="container">
    <div class="ham" style="float: right;">

        <i class="fa fa-th HIDE" style="font-size:36px;color:white; cursor: pointer;">
                              </i>
    </div>
    <div class="ak1 ">

        <div class="one1" id="wrap">
            <div id="contain">
                <!-- <canvas id="imageView" width="600" height="650" style="display:none">
                        </canvas> -->

                <div id="board">
                    <h1 class="vertical-align">LOADING...</h1>

                </div>
                <!-- <ul class="list-inline panel-actions">
                    <li><a href="#" id="fullscreen" class="btn-01"><i class="fa fa-th-large"></i></a></li>
                </ul> -->
                <!-- <svg><defs><marker id="arrowhead-g" orient="auto" markerWidth="4" markerHeight="8" refX="2.05" refY="2.01" cgKey="g"><path d="M0,0 V4 L3,2 Z" fill="#15781B"></path></marker><marker id="arrowhead-pb" orient="auto" markerWidth="4" markerHeight="8" refX="2.05" refY="2.01" cgKey="pb"><path d="M0,0 V4 L3,2 Z" fill="#003088"></path></marker></defs><line stroke="#15781B" stroke-width="2.5" stroke-linecap="round" marker-end="url(#arrowhead-g)" opacity="1" x1="40" y1="88" x2="70.23223304703363" y2="57.76776695296637" cgHash="c3e5green"></line><line stroke="#003088" stroke-width="3.75" stroke-linecap="round" marker-end="url(#arrowhead-pb)" opacity="0.4" x1="56" y1="104" x2="56" y2="74.5" cgHash="d2d4paleBlue"></line></svg> -->
            </div>


            <!-- <div id="fenBox"> -->
            <!-- <button class="littleButton" id="setFEN">SET FEN</button> -->
            <!-- <div class="input-icon-wrap">
                    <span class="input-icon">FEN</span>
                    <span id="fen"><input type="text" class="input-with-icon" id="fen" />    </span>
                </div>

            </div>

            <div class="input-icon-wrap">
                <span class="input-icon">PGN</span>
                <span id="pgn1" class="pgn"><input type="text" class="input-with-icon " id="pgn1" />    </span>

            </div>

            <div class="import">
                <button class="btn draw-border" style="margin-right:16px;" id="setFEN">Enter FEN</button>
                <button class="btn draw-border" style="margin-right:16px;" id="export">Export PGN</button>

                <div class="box">
                    <a class="btn draw-border" href="#popup1">Import PGN</a>
                </div>

            </div> -->

            <!-- <p><label>Drawing tool: <select id="dtool"><option value="line">Line</option><option value="rect">Rectangle</option><option value="pencil">Pencil</option></select></label></p>
            <div id="popup1" class="overlay">
                <div class="popup">
                    <h2>Choose Options</h2>
                    <a class="close" href="#">&times;</a>
                    <div class="content">
                        <button class="btn draw-border" style="margin-right:16px;" id="setPGN">Enter PGN</button>
                        <input type='file' onchange='onChooseFile(event, onFileLoad.bind(this, "contents"))' />
                    </div>
                </div>
            </div> -->

        </div>
        <!-- Vertical toolbar -->
        <!-- <div class="toolbar">

        </div> -->
        <div class="two2" id="tar">
            <div class="toolbar-vertical">
                <div class="btn-toolbar">
                    <div class="btn-group-vertical" role="group" aria-label="...">
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Share">
                            <span class="fa fa-share-alt" style="font-size:20px"></span>
                        </button>
                    </div>
                    <hr>
                    <div class="btn-group-vertical" role="group" aria-label="...">
                        <button class="btn btn-default guage101" data-toggle="tooltip" data-placement="left" data-container="body" title="Hide & Show Analysis Bar">
                                <span class="fa fa-th-large " style="font-size:20px"></span>
                            </button>
                    </div>
                    <hr>

                    <!-- <div class="btn-group-vertical" role="group" aria-label="...">
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Available applications">
                         <span class="glyphicon glyphicon-th-large"></span></button>
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Selected filters"><span class="glyphicon glyphicon-mars"></span></button>
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Saved selections"><span class="glyphicon glyphicon-mars"></span></button>
                    </div> -->
                    <div class="btn-group-vertical" style="margin-top:4%;" role="group" aria-label="...">
                        <input type="hidden" id="color" value="green">
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Green Arrow" value="green" onclick="showColor('green')"><span class="	fa fa-arrows-v" style="font-size: 20px;color:green;" value="green" onclick="showColor('green')"></span></button>
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Red Arrow" value="red" onclick="showColor('red')"><span class="	fa fa-arrows-v" style="font-size: 20px;color:red;" value="red" onclick="showColor('red')"></span></button>
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Yellow Arrow" value="yellow" onclick="showColor('yellow')"><span class="	fa fa-arrows-v" style="font-size:20px;color:yellow;"></span></button>
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Blue Arrow" value="blue" onclick="showColor('blue')"><span class="	fa fa-arrows-v" style="font-size:20px;color:blue;" ></span></button>
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Black Arrow" value="black" onclick="showColor('black')"><span class="	fa fa-arrows-v" style="font-size:20px;color:black;" value="black" onclick="showColor('black')"></span></button>
                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Orangered Arrow" value="orangered" onclick="showColor('orangered')"><span class="	fa fa-arrows-v" style="font-size:20px;color:orangered;" value="orangered" onclick="showColor('orangered')"></span></button>

                        <button class="btn btn-default" data-toggle="tooltip" data-placement="left" data-container="body" title="Delete Arrow"><span class="fas fa-trash"  id="btn_delar" style="font-size:18px;"></span></button>
                        <p style="display: none;"><label>Drawing tool: <select id="dtool"><option value="line">Line</option><option value="rect">Rectangle</option><option value="pencil">Pencil</option></select></label></p>
                    </div>
                </div>
            </div>
            <div class="container">
                <section class="content" id="body">
                    <div id="side">
                        <div id="status"></div>
                        <div class="wrapper1" style="">
                            <div id="gauge" style="display:none"></div>
                            <div class="progress-bar1" id="guage1">
                                <div class="progress1" style="width:50%; background-position:1%;"></div>
                            </div>
                            <div><input id="setVal" type="hidden" pattern="\d*" /></div>
                        </div>
                        <!--<div  style="height:fit-content;">
                            {% for h in heats%}
                            <h4> {{h.tournment}}</h4><br>
                            {{h.player1}} VS {{h.player2}}
                            {% endfor %}
                        </div>-->
                        <center style="margin-top: 3%;">
                            <h4>Game Moves(dsh-1)</h4>
                        </center>

                        <!-- <div id="pgnBox" >
                        <button class="littleButton" id="setPGN">SET PGN</button>
                        <div id="pgn"></div>
                      </div> -->
                        <div id="pgn">

                            <!-- <span class="gameMove"><a id="myLink" href="#" onclick="goToMove(0)">e1</a></span> -->
                        </div>
                    </div>

                    <div class="buttonpanel1">
                        <i class='fas fa-angle-double-left yellowButton' style='font-size:36px' id="startBtn"></i>
                        <i class='fas fa-chevron-left yellowButton' style='font-size:36px' id="backBtn"></i>
                        <i class='fa fa-play yellowButton' style='font-size:36px' onclick="hideplay()" id="playBtn"></i>
                        <i class='fa fa-pause yellowButton' style='font-size:36px;   display:none' onclick="showplay()" id="pause"></i>
                        <input type="hidden" id="playcount"><input type="hidden" id="movecount">
                        <i class='fas fa-chevron-right yellowButton' style='font-size:36px' id="forwardBtn"></i>
                        <i class='fas fa-angle-double-right yellowButton' style='font-size:36px' id="endBtn"></i>
                    </div>
                    <div class="import">
                        <a href="{% url 'dashboard:test' %}"> <button class="btn draw-border" style="margin-right:16px;">Live Game</button></a>


                    </div>
                    <hr class="new1">
            </div>
            </section>
        </div>
        <!-- Modal -->
        <div class="modal right fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel2">Board Settings</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                        <div id="toolbar">
                            <form>
                                <div class="form-group">
                                    <select class="form-control" id="board-style">
                                        <option value="wood"  selected>2D Board style</option>
                                        <option value="aluminium">Aluminium</option>
                                        <option value="cherry">Cherry</option>
                                        <option value="lapis">Lapis</option>
                                        <option value="marble">Marble</option>
                                        <option value="sand">Sand</option>
                                        <option value="slate">Slate</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <select class="form-control" id="piece-style">
                                        <option value="alpha">2D Piece style</option>
                                        <option value="leipzig">Leipzing</option>
                                        <option value="dilena">Dilena</option>
                                        <option value="chess24">Chess24</option>
                                        <option value="symbol">Berlin</option>
                                        <option value="metro">Berlin outline + shadow</option>
                                        <option value="uscf">Uscf</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="white-square-color">White Squares Color</label>
                                    <input type="color" class="form-control" value="#F0EAB9" onchange="setSquaresColor(this.value)" id="white-square-color" />
                                </div>
                                <div class="form-group">
                                    <label for="black-square-color">Black Squares Color</label>
                                    <input type="color" class="form-control" value="#CA906E" onchange="setSquaresColor(null, this.value)" id="black-square-color" />
                                </div>
                                <div class="form-group">
                                    <label for="border-color">Border Color</label>
                                    <input type="color" class="form-control" value="#b52828" onchange="setSquaresColor(null, null,this.value)" id="border-color" />
                                </div>
                            </form>
                        </div>
                        <div class="bk">
                            <div class="theme-switch-wrapper ">
                                <h5> Background Theme </h5>
                                <label class="theme-switch" for="checkbox">
                              <input type="checkbox" id="checkbox" onclick="toggleDarkLight()" />
                              <div class="slider round"></div>
                            </label>
                            </div>
                        </div>
                        <div id="gaugebox">
                            <div id="optionsBox">
                                <br>
                                <label for="engineMenu">Chess Engine:</label>
                                <select id="engineMenu">
                                <option value="/static/js/p4wn.js">p4wn</option>
                                <option value="/static/js/lozza.js" >Lozza</option>
                                <option value="/static/js/stockfish.js"selected>stockfish</option>
                            </select>
                                <!-- <br>
                            <label for="moveTime">MOVE TIME (seconds):</label>
                            <select id="moveTime">
                                <option value="100">0.1</option>
                                <option value="200">0.2</option>
                                <option value="500">0.5</option>
                                <option value="1000" selected>1</option>
                                <option value="2000">2</option>
                                <option value="5000">5</option>
                                <option value="10000">10</option>
                                <option value="20000">20</option>
                            </select>
                            <br>
                            <label for="promotion">PROMOTE PAWNS TO:</label>
                            <select id="promotion">
                                <option value="q">queens</option>
                                <option value="n">knights</option>
                                <option value="r">rooks</option>
                                <option value="b">bishops</option>
                            </select> -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- modal-content -->
            </div>
            <!-- modal-dialog -->
        </div>
        <!-- modal -->
        <!-- Modal -->
        <div class="modal right fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel">PGN Setting</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

                    </div>

                    <div class="modal-body">

                        <div class="import">
                            <button class="btn draw-border" style="margin-right:16px;" id="setFEN">Enter FEN</button>
                            <button type="submit" class="btn draw-border" style="margin-right:16px;" id="export">Export PGN</button>
                        </div>
                        <div hidden>
                            <form id="upload_pgn" method="POST" action="{% url 'dashboard:uploadpgn' %}">
                                {% csrf_token %}
                                <textarea name="fd_pgn" id="fd_pgn" rows="6" cols="50">
                                </textarea>
                                {% for h in heats%}
                                <input type="text" name="fd_tournment" id="fd_tournment" value="{{h.tournament}}">
                                <!--<input type="text" name="fd_round" id="fd_round" value="{{h.round}}">-->
                                <input type="text" name="fd_player1" id="fd_player1" value="{{h.player1}}">
                                <input type="text" name="fd_player2" id="fd_player2" value="{{h.player2}}">
                                {% endfor %}
                            </form>
                        </div>
                        <input type="checkbox" id="check" />
                        <label for="check" class="btn draw-border" style="margin-right: 20%;
                        margin-top:4%;">Import PGN</label>
                        <nav class="nav1">
                            <ul class="ul">
                                <li class="li">
                                    <button class="btn draw-border" style="margin-right:16px;" id="setPGN">Enter PGN</button>

                                </li>
                                <li class="li">

                                    <div class="content1"><input type='file' onchange='onChooseFile(event, onFileLoad.bind(this, "contents"))' />
                                    </div>

                                </li>

                            </ul>
                        </nav>
                    </div>




                </div>

            </div>
            <!-- modal-content -->
        </div>
        <!-- modal-dialog -->
    </div>
    <!-- modal -->


    </div>
    <!-- container -->

    </div>

    <ul class="menu">

        <li title="Hide & Show Menu"><a href="#" class="menu-button btn1111 home">menu</a></li>

        <li title="Hint"><a href="#" class="search" id="hintBtn">Hint</a></li>
        <li title="Reset"><a href="#" class="pencil" id="resetBtn">pencil</a></li>
        <li title="Pgn Setting"><a href="#" class="active about" data-toggle="modal" data-target="#myModal">about</a></li>
        <li title="Flip"><a href="#" class="archive" id="flipBtn">archive</a></li>
        <li title="Board Setting"><a href="#" class="contact" data-toggle="modal" data-target="#myModal2">contact</a></li>

        <li title="Arrow Analysis"><a href="#" id="btn_drawar" name="btn_drawar" class="ar_analysis">analysis</a></li>
    </ul>

    <!-- <ul class="">
        <li><a href="#" class="menu-button btn1111">Menu</a></li>
        <li><a href="#">Home</a></li>
        <li><a href="#">Profile</a></li>
        <li><a href="#">Editorial</a></li>
        <li><a href="#">About</a></li>
    </ul> -->

</article>


<!-- <script>
    var element = document.getElementById('wrap');
    var fullscreen = document.getElementById('fullscreen');


    fullscreen.addEventListener('click', function() {
        var boardDiv = $('#wrap');

        // This is a chessboard.js board. Adjust for 1:1 aspect ratio

        boardDiv.css('width', '80%');
        boardDiv.css('height', '65%');
        if (element.requestFullscreen) {


            element.requestFullscreen();
        } else if (element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
        } else if (element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen();
        }
    });
</script> -->
<script>
    $(function() {
        $('[data-toggle="tooltip"]').tooltip()
    });
</script>
<script>
    /* When the user clicks on the button, 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            toggle between hiding and showing the dropdown content */
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show1");
    }



    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show1')) {
                    openDropdown.classList.remove('show1');
                }
            }
        }
    }
</script>
<script>
    $(document).ready(function() {

        function toggleSidebar() {
            $(".button").toggleClass("active");
            $("main").toggleClass("move-to-left");
            $(".sidebar-item").toggleClass("active");
        }

        $(".button").on("click tap", function() {
            toggleSidebar();
        });

        $(document).keyup(function(e) {
            if (e.keyCode === 27) {
                toggleSidebar();
            }
        });

    });
</script>
<script>
    $(document).ready(function() {
        $(".ar_analysis").click(function() {
            $(".toolbar-vertical").toggle();
        });
    });
</script>
<script>
    $(document).ready(function() {
        $(".guage101").click(function() {
            $("#guage1").toggle();


        });
    });
</script>
<script>
    $(document).ready(function() {
        $(".ar_analysis").click(function() {
            $("#imageView").toggle();
            $("#imageTemp").toggle();
        });
    });
</script>
<script>
    $(".btn1111").click(function() {

        var lable = $(".btn1111").text().trim();

        if (lable == "Hide") {
            $(".btn1111").text("Show");
            $(".two2").show();
        } else {
            $(".btn1111").text("Hide");
            $(".two2").hide();
        }

    });
</script>
<script>
    jQuery(document).ready(function(e) {
        function t(t) {
            e(t).bind("click", function(t) {
                t.preventDefault();
                e(this).parent().fadeOut()
            })
        }
        e(".dropdown-toggle").click(function() {
            var t = e(this).parents(".button-dropdown").children(".dropdown-menu").is(":hidden");
            e(".button-dropdown .dropdown-menu").hide();
            e(".button-dropdown .dropdown-toggle").removeClass("active");
            if (t) {
                e(this).parents(".button-dropdown").children(".dropdown-menu").toggle().parents(".button-dropdown").children(".dropdown-toggle").addClass("active")
            }
        });
        e(document).bind("click", function(t) {
            var n = e(t.target);
            if (!n.parents().hasClass("button-dropdown")) e(".button-dropdown .dropdown-menu").hide();
        });
        e(document).bind("click", function(t) {
            var n = e(t.target);
            if (!n.parents().hasClass("button-dropdown")) e(".button-dropdown .dropdown-toggle").removeClass("active");
        })
    });
</script>
<script>
    $(function() {
        var engine = new Worker("/static/js/stockfish.js");
        console.log("GUI: uci");
        engine.postMessage("uci");
        console.log("GUI: ucinewgame");
        engine.postMessage("ucinewgame");


        // console.log(moveList.length - 1);
        var scoreList = [];
        var cursor = 0;
        var moveList = [];

        //alert(4);
        //goToMove(0);

        var player = 'w';
        var entirePGN = ''; // longer than current PGN when rewind buttons are clicked


        //goToMove(-1);
        var board;
        var game = new Chess(), // move validation, etc.
            statusEl = $('#status'),
            fenEl = $('#fen'),
            pgnEl = $('#pgn');
        pgnEll = $('#pgn1');
        var whiteSquareGrey = '#a9a9a9';
        var blackSquareGrey = '#696969';
        // true for when the engine is processing; ignore_mouse_events is always true if this is set (also during animations)
        var engineRunning = false;

        // don't let the user press buttons while other button clicks are still processing
        var board3D = ChessBoard3.webGLEnabled();

        if (!board3D) {
            swal("WebGL unsupported or disabled.", "Using a 2D board...");
            $('#dimensionBtn').remove();
        }

        var scoreGauge = $('#gauge').SonicGauge({
            label: 'WHITE\'S ADVANTAGE\n(centipawns)',
            start: {
                angle: -230,
                num: -2000
            },
            end: {
                angle: 50,
                num: 2000
            },
            markers: [{
                gap: 200,
                line: {
                    "width": 11,
                    "stroke": "none",
                    "fill": "#cccccc"
                },
                text: {
                    "space": -20,
                    "text-anchor": "middle",
                    "fill": "#cccccc",
                    "font-size": 8
                }
            }, {
                gap: 100,
                line: {
                    "width": 9,
                    "stroke": "none",
                    "fill": "#999999"
                }
            }, {
                gap: 50,
                line: {
                    "width": 7,
                    "stroke": "none",
                    "fill": "#888888"
                }
            }],
            animation_speed: 200,
            diameter: 250,
            style: {
                label: {
                    "font-size": 9,
                    fill: '#cccccc'
                },
                center: {
                    fill: 'r#f46a3a-#890b0b'
                },
                outline: {
                    fill: 'r#888888-#000000',
                    stroke: 'black',
                    'stroke-width': 1
                }
            }
        });


        function updateScoreGauge(score) {
            document.getElementById('setVal').value = score;

            var $p = $('.progress1');
            var $input = $('input');

            if (score >= 0) {

                if (score <= 2500 && score > 0) {

                    $p.css({
                        width: 180 + score + 'px',
                        backgroundPosition: score + 'px'
                    });
                }
            }
            if (score < 0) {

                if (score < 0 && score > -2500) {
                    if (score > -180) {
                        var tt = (180) + (score);


                    } else {
                        var t = (180) + (score);
                        var tt = 180 + (t);


                    }
                    $p.css({

                        width: tt + 'px',
                        backgroundPosition: tt + 'px'
                    });
                }
            }




            scoreGauge.SonicGauge('val', parseInt(score, 10));
        }




        function adjustBoardWidth() {
            var fudge = 250;
            var windowWidth = $(window).width();
            var windowHeight = $(window).height();
            var desiredBoardWidth = $('.one1').outerWidth(true);
            var desiredBoardHeight = windowHeight - $('#header').outerHeight(true) - $('#banner').outerHeight(true) - $('#footer').outerHeight(true) - fudge;

            var boardDiv = $('#board');
            if (board3D) {
                // Using chessboard3.js.
                // Adjust for 4:3 aspect ratio
                desiredBoardWidth &= 0xFFFC; // mod 4 = 0
                desiredBoardHeight -= (desiredBoardHeight % 3); // mod 3 = 0
                if (desiredBoardWidth * 0.75 > desiredBoardHeight) {
                    desiredBoardWidth = desiredBoardHeight * 4 / 3;
                }
                boardDiv.css('width', '80%');
                boardDiv.css('height', '100%');

            } else {
                // This is a chessboard.js board. Adjust for 1:1 aspect ratio
                desiredBoardWidth = Math.min(desiredBoardWidth, desiredBoardHeight);
                boardDiv.css('width', '80%');
                boardDiv.css('height', '65%');
            }
            if (board !== undefined) {
                board.resize();
            }
        }

        function fireEngine() {
            engineRunning = true;
            updateStatus();
            var currentScore;
            var msg = "position fen " + game.fen();
            //console.log("GUI: " + msg);
            engine.postMessage(msg);
            msg = 'go movetime ' + $('#moveTime').val();
            //console.log("GUI: " + msg);
            engine.postMessage(msg);
            engine.onmessage = function(event) {
                var line = event.data;

                //console.log("ENGINE: " + line);
                var best = parseBestMove(line);
                if (best !== undefined) {
                    var move = game.move(best);
                    moveList.push(move);
                    //console.log(moveList);



                    //var gameMoves = moveList.replace(/\[(.*?)\]/gm, '').replace(h.Result, '').trim();
                    //console.log(gameMoves);
                    if (currentScore !== undefined) {
                        if (scoreList.length > 0) {
                            scoreList.pop(); // remove the dummy score for the user's prior move
                            scoreList.push(currentScore); // Replace it with the engine's opinion
                        }
                        scoreList.push(currentScore); // engine's response
                    } else {
                        scoreList.push(0); // not expected
                    }
                    cursor++;
                    board.position(game.fen(), true);
                    engineRunning = false;
                    updateStatus();
                } else {
                    // Before the move gets here, the engine emits info responses with scores
                    var score = parseScore(line);
                    if (score !== undefined) {
                        if (player === 'w') {
                            score = -score; // convert from engine's score to white's score
                        }
                        updateScoreGauge(score);
                        currentScore = score;
                    }
                }
            };
        }



        function parseBestMove(line) {
            var match = line.match(/bestmove\s([a-h][1-8][a-h][1-8])(n|N|b|B|r|R|q|Q)?/);
            if (match) {
                var bestMove = match[1];
                var promotion = match[2];
                return {
                    from: bestMove.substring(0, 2),
                    to: bestMove.substring(2, 4),
                    promotion: promotion
                }
            }
        }

        function parseScore(line) {
            var match = line.match(/score\scp\s(-?\d+)/);
            if (match) {
                return match[1];
            } else {
                if (line.match(/mate\s-?\d/)) {
                    return 2500;
                }
            }
        }




        function updateStatus() {

            var status = '';

            var moveColor = 'White';
            if (game.turn() === 'b') {
                moveColor = 'Black';
            }

            if (game.game_over()) {

                if (game.in_checkmate()) {
                    status = moveColor + ' checkmated.';
                } else if (game.in_stalemate()) {
                    status = moveColor + " stalemated";
                } else if (game.insufficient_material()) {
                    status = "Draw (insufficient material)."
                } else if (game.in_threefold_repetition()) {
                    status = "Draw (threefold repetition)."
                } else if (game.in_draw()) {
                    status = "Game over (fifty move rule)."
                }
                swal({
                    title: "Game Over",
                    text: status,
                    type: 'info',
                    showCancelButton: false,
                    confirmButtonColor: "#DD6655",
                    onConfirmButtonText: 'OK',
                    closeOnConfirm: true
                });
                engineRunning = false;
            }

            // game still on
            else {
                if (player === 'w') {
                    status = "Computer playing Black; ";
                } else {
                    status = "Computer playing White; ";
                }
                status += moveColor + ' to move.';

                // check?
                if (game.in_check() === true) {
                    status += ' ' + moveColor + ' is in check.';
                }
            }

            fenEl.html(game.fen().replace(/ /g, '&nbsp;'));
            var currentPGN = game.pgn({
                max_width: 10,
                //newline_char: "<br>"
            });
            //console.log(entirePGN);
            var matches = entirePGN.lastIndexOf(currentPGN, 0) === 0;
            if (matches) {
                currentPGN += "<span>" + entirePGN.substring(currentPGN.length, entirePGN.length) + "</span>";
            } else {
                entirePGN = currentPGN;
            }
            // pgnEl.html(currentPGN);
            //currentPGN = currentPGN.trim();
            moveArray = [];

            var h = game.header();
            moveArray = moveArray.push(currentPGN);
            var gameMoves = currentPGN.replace(/\[(.*?)\]/gm, '').trim();
            console.log(gameMoves);
            moveArray = game.history();
            //format the moves so each one is individually identified, so it can be highlighted
            moveArray = gameMoves.split(/([0-9]+\.\s)/).filter(function(n) {
                return n;
            });
            for (var i = 0, l = moveArray.length; i < l; ++i) {
                var s = $.trim(moveArray[i]);
                if (!/^[0-9]+\.$/.test(s)) { //move numbers
                    m = s.split(/\s+/);
                    console.log(m);
                    for (var j = 0, ll = m.length; j < ll; ++j) {
                        m[j] = '<span class="gameMove' + (i + j - 1) + '"><a id="myLink" href="#" onclick="goToMove(' + (i + j - 1) + ');return false;">' + m[j] + '</a></span>';
                    }
                    s = m.join(' ');
                }
                moveArray[i] = s;
            }
            var gameData = '<div class="gameMoves">' + moveArray + '</div>';
            console.log("game moves ", gameData);



            pgnEl.html(gameData);


            if (engineRunning) {
                // status += ' Thinking...';
                status += ' ';
            }
            pgnEll.html(currentPGN);
            if (engineRunning) {
                // status += ' Thinking...';
                status += ' ';
            }
            statusEl.html(status);
        };




        // Set up chessboard
        var onDrop = function(source, target) {

            if (engineRunning) {
                return 'snapback';
            }

            if (board.hasOwnProperty('removeGreySquares') && typeof board.removeGreySquares === 'function') {
                board.removeGreySquares();
            }

            // see if the move is legal
            var move = game.move({
                from: source,
                to: target,
                promotion: 'q' //$("#promotion").val()
            });



            // illegal move
            if (move === null) return 'snapback';
            // highlight black's move

            removeHighlights('white')
            $board.find('.square-' + source).addClass('highlight-white')
            $board.find('.square-' + target).addClass('highlight-white')

            if (cursor === 0) {
                console.log("GUI: ucinewgame");
                engine.postMessage("ucinewgame");
            }
            moveList = moveList.slice(0, cursor);
            scoreList = scoreList.slice(0, cursor);
            moveList.push(move);
            // User just made a move- add a dummy score for now. We will correct this element once we hear from the engine
            scoreList.push(scoreList.length === 0 ? 0 : scoreList[scoreList.length - 1]);
            cursor = moveList.length;
            //console.log(cursor);
        };


        var $board = $('#board')
        var squareClass = 'square-55d63'

        function removeHighlights(color) {
            $board.find('.' + squareClass)
                .removeClass('highlight-' + color)
        }
        // update the board position after the piece snap
        // for castling, en passant, pawn promotion
        var onSnapEnd = function() {

            if (!game.game_over() && game.turn() !== player) {
                fireEngine();
            }

        };

        var squareToHighlight = null

        function onMouseoverSquare(square, piece) {
            // get list of possible moves for this square
            var moves = game.moves({
                square: square,
                verbose: true
            })

            // exit if there are no moves available for this square
            if (moves.length === 0) {
                ondragpostion(square);
            }

            // highlight the square they moused over
            greySquare(square)

            // highlight the possible squares for this piece
            for (var i = 0; i < moves.length; i++) {
                board.addArrowAnnotation(square, moves[i].to)
                greySquare(moves[i].to)
            }
        }

        $('input[type="checkbox"][name="btn_drawar"]').change(function() {

            if (this.checked) {

                $('#imageView').css('display', 'initial');
                $('#imageTemp').css('display', 'initial');
                $('#imageView').css('z-index', 1);
                $('#imageTemp').css('z-index', 11);
                $('#board').css('z-index', -1111);
            } else {

                $('#imageView').css('display', 'none');
                $('#imageView').css('z-index', -1);
                $('#imageTemp').css('z-index', -11);
                $('#board').css('z-index', 1111);
            }
        });

        function ondragpostion(square) {
            //board.addArrowAnnotation(square, "h5"); 
        }

        function onMouseoutSquare(square, piece) {
            board.clearAnnotation()
            removeGreySquares()
        }

        function removeGreySquares() {
            $('#board .square-55d63').css('background', '')
        }

        function greySquare(square) {
            // alert(square);
            var square = $('#board .square-' + square)

            var background = whiteSquareGrey
            if (square.hasClass('black-3c85d')) {
                background = blackSquareGrey
            }

            square.css('background', background)


        }



        function onMoveEnd() {
            $board.find('.square-' + squareToHighlight)
                .addClass('highlight-black')
        }

        function createBoard(pieceSet, args, args1, args2) {
            // alert(pieceSet+"->"+args);
            var cfg = {

                cameraControls: true,
                draggable: true,
                position: 'r1bqkb1r/ppp2ppp/2n2n2/4p3/8/2pPPPPP/PP6/RNBQKBNR w KQkq - 0 7',
                onDrop: onDrop,
                onMouseoutSquare: onMouseoutSquare,
                onMouseoverSquare: onMouseoverSquare,
                onSnapEnd: onSnapEnd,
                onMoveEnd: onMoveEnd,
                overlay: true
            };


            //goToMove(moveList.length - 1);
            // if (board3D) {
            //     if (pieceSet) {
            //         if (pieceSet === 'minions') {
            //             cfg.whitePieceColor = 0xFFFF00;
            //             cfg.blackPieceColor = 0xCC00CC;
            //             cfg.lightSquareColor = 0x888888;
            //             cfg.darkSquareColor = 0x666666;
            //         }
            //         cfg.pieceSet = '/static/assets/chesspieces/' + pieceSet + '/{piece}.json';
            //     }
            //     return new ChessBoard3('board', cfg);
            //   } else {

            if (args == '2D') {
                if (args1 == 'piece') {
                    var selectedVal = $("#board-style option:selected").val();
                    if (selectedVal == 'aluminium') {

                        // cfg.boardTheme = ["#6fadd4", "#d0ceca"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/ab.png')", "url('/static/img/chesspieces/board/aw.png')", "url('/static/img/chesspieces/board/ab.png')"]

                        });


                    }
                    if (selectedVal == 'cherry') {

                        //cfg.boardTheme = ["#521b01", "#b45119"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/cherry1.png')", "url('/static/img/chesspieces/board/cherry2.png')", "url('/static/img/chesspieces/board/cherry2.png')"]

                        });
                    }
                    if (selectedVal == 'lapis') {

                        //cfg.boardTheme = ["#244251", "#c9b46b"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/wb.png')", "url('/static/img/chesspieces/board/ww.png')", "url('/static/img/chesspieces/board/wb.png')"]

                        });
                    }
                    if (selectedVal == 'marble') {

                        //cfg.boardTheme = ["#bb886e", "#e9d2b7"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/marble1.png')", "url('/static/img/chesspieces/board/marble2.png')", "url('/static/img/chesspieces/board/marble1.png')"]

                        });
                    }
                    if (selectedVal == 'sand') {

                        //cfg.boardTheme = ["#c8a97d", "#fdedb7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/sand1.png')", "url('/static/img/chesspieces/board/sand2.png')", "url('/static/img/chesspieces/board/sand1.png')"],
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png'
                        });
                    }
                    if (selectedVal == 'slate') {

                        //cfg.boardTheme = ["#8c8c8c", "#c9c9c9"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/slate1.png')", "url('/static/img/chesspieces/board/slate2.png')", "url('/static/img/chesspieces/board/slate2.png')"]

                        });
                    } else {
                        //cfg.boardTheme = ["#ae6c37", "#d4b171"];#244251", "#c9b46b

                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',

                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/lapis/lapis1.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')"]


                        });
                    }



                    //cfg.pieceTheme = '/static/img/chesspieces/' + pieceSet + '/{piece}.png';


                    //return new ChessBoard('board', cfg);
                }
                if (args1 == 'board') {
                    if (pieceSet == 'aluminium') {
                        // cfg.boardTheme = ["#6fadd4", "#d0ceca"];

                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/ab.png')", "url('/static/img/chesspieces/board/aw.png')", "url('/static/img/chesspieces/board/ab.png')"]

                        });

                    }
                    if (pieceSet == 'cherry') {

                        //cfg.boardTheme = ["#521b01", "#b45119"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/cherry1.png')", "url('/static/img/chesspieces/board/cherry2.png')", "url('/static/img/chesspieces/board/cherry2.png')"]

                        });
                    }
                    if (pieceSet == 'lapis') {

                        //cfg.boardTheme = ["#244251", "#c9b46b"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/wb.png')", "url('/static/img/chesspieces/board/ww.png')", "url('/static/img/chesspieces/board/wb.png')"]

                        });
                    }
                    if (pieceSet == 'marble') {

                        //cfg.boardTheme = ["#bb886e", "#e9d2b7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/marble1.png')", "url('/static/img/chesspieces/board/marble2.png')", "url('/static/img/chesspieces/board/marble1.png')"]

                        });
                    }
                    if (pieceSet == 'sand') {

                        //cfg.boardTheme = ["#c8a97d", "#fdedb7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/sand1.png')", "url('/static/img/chesspieces/board/sand2.png')", "url('/static/img/chesspieces/board/sand1.png')"]

                        });
                    }
                    if (pieceSet == 'slate') {

                        //cfg.boardTheme = ["#8c8c8c", "#c9c9c9"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/slate1.png')", "url('/static/img/chesspieces/board/slate2.png')", "url('/static/img/chesspieces/board/slate2.png')"]

                        });
                    }
                    return new ChessBoard('board', cfg);
                }

            } else {
                //cfg.boardTheme = ["#ae6c37", "#d4b171"];#244251", "#c9b46b

                return new ChessBoard('board', {
                    draggable: true,
                    position: 'start',
                    onDrop: onDrop,
                    onSnapEnd: onSnapEnd,
                    boardTheme: ["url('/static/img/chesspieces/board/lapis/lapis1.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')"]


                });
            }

            // }
        }


        adjustBoardWidth();
        board = createBoard();

        $(window).resize(function() {
            adjustBoardWidth();
        });
        //console.log(board.position());






        // Set up buttons
        $('#startBtn').on('click', function() {
            var cursorStart = 0;
            if (player === 'b') {
                cursorStart = 1;
            }
            while (cursor > cursorStart) {
                game.undo();
                cursor--;
            }
            updateScoreGauge(0);
            board.position(game.fen());
            updateStatus();
        });
        $('#backBtn').on('click', function() {
            if (cursor > 0) {
                cursor--;
                game.undo();
                board.position(game.fen());
                var score = cursor === 0 ? 0 : scoreList[cursor - 1];
                updateScoreGauge(score);
                updateStatus();
            }
        });
        $('#forwardBtn').on('click', function() {
            if (cursor < moveList.length) {
                game.move(moveList[cursor]);
                var score = scoreList[cursor];
                updateScoreGauge(score);
                board.position(game.fen());
                cursor++;
                updateStatus();
            }
        });




        var cursorStart1 = 0;
        var pause_value = "play";
        $('#playBtn').on('click', function() {
            pause_value = "play";
            //cursorStart=0;
            while (cursor > cursorStart1) {
                game.undo();
                cursor--;
            }
            updateScoreGauge(0);
            board.position(game.fen());
            updateStatus();
            if (pause_value == "play") {
                play();
            } else {
                if (pause_value == "pause") {
                    stop();
                } else {
                    return;
                }
            }

        });

        function play() {
            var k = moveList.length;
            document.getElementById('movecount').value = k;
            // var pause = document.getElementById('playcount').value;
            var me = this;
            var delay = 1000;
            var timerId = null;
            var moveId = 0;
            for (i = k; i > 0; i--) {
                document.getElementById('movecount').value = i;
                setTimeout(function timer() {
                    if (pause_value == 'pause') {

                    } else {

                        game.move(moveList[cursor]);
                        var score = scoreList[cursor];
                        board.position(game.fen());
                        cursor++;
                        updateStatus();
                        updateScoreGauge(score);
                    }

                }, i * delay);
                cursorStart1++;

            }


        }
        $('#pause').on('click', function() {
            pause_value = "pause";
            document.getElementById("board").disabled = true;
            if (pause_value == "play") {
                play();
            } else {
                //pause_value="play";
            }

        });

        function stop() {}
        $('#endBtn').on('click', function() {
            while (cursor < moveList.length) {
                game.move(moveList[cursor++]);
            }
            board.position(game.fen());
            updateScoreGauge(scoreList.length == 0 ? 0 : scoreList[cursor - 1]);
            updateStatus();
        });
        $('#hintBtn').on('click', function() {
            if (game.turn() === player) {
                engineRunning = true;
                var msg = "position fen " + game.fen();
                console.log("GUI: " + msg);
                engine.postMessage(msg);
                msg = 'go movetime ' + $('#moveTime').val();
                console.log(msg);
                engine.postMessage(msg);
                engine.onmessage = function(event) {
                    console.log("ENGINE: " + event.data);
                    var best = parseBestMove(event.data);
                    if (best !== undefined) {
                        var currentFEN = game.fen();
                        game.move(best);
                        var hintedFEN = game.fen();
                        game.undo();
                        board.position(hintedFEN, true);
                        // give them a second to look before sliding the piece back
                        setTimeout(function() {
                            board.position(currentFEN, true);
                            engineRunning = false;
                        }, 1000); // give them a second to look
                    }
                }
            }
        });
        $('#flipBtn').on('click', function() {
            if (game.game_over()) {
                return;
            }
            board.flip(); //wheeee!
            if (player === 'w') {
                player = 'b';
            } else {
                player = 'w';
            }
            updateStatus();
            setTimeout(fireEngine, 1000);
        });

        $('#dimensionBtn').on('click', function() {
            var dimBtn = $("#dimensionBtn");
            var sel = document.getElementById('dimensionBtn').value;
            dimBtn.prop('disabled', true);
            var position = board.position();
            var orientation = board.orientation();
            board.destroy();
            board3D = !board3D;
            adjustBoardWidth();
            if (sel == '3D') {

                dimBtn.val(board3D ? '3D' : '2D');
                setTimeout(function() {

                    board = createBoard($('#piecesMenu').val(), sel);
                    board.orientation(orientation);
                    board.position(position);
                    $("#dimensionBtn").prop('disabled', false);
                });
            }
            if (sel == '2D') {
                setTimeout(function() {

                    board = createBoard($('#piece-style').val(), sel);
                    console.log(board);
                    board.orientation(orientation);
                    board.position(position);
                    $("#dimensionBtn").prop('disabled', false);

                });
            }


        });


        $("#setFEN").on('click', function(e) {
            swal({
                title: "SET FEN",
                text: "Enter a FEN position below:",
                type: "input",
                inputType: "text",
                showCancelButton: true,
                closeOnConfirm: false
            }, function(fen) {
                if (fen === false) {
                    return; //cancel
                }
                fen = fen.trim();
                console.log(fen);
                var fenCheck = game.validate_fen(fen);
                console.log("valid: " + fenCheck.valid);
                if (fenCheck.valid) {
                    game = new Chess(fen);
                    console.log("GUI: ucinewgame");
                    engine.postMessage('ucinewgame');
                    console.log("GUI: position fen " + fen);
                    engine.postMessage('position fen ' + fen);
                    board.position(fen);
                    fenEl.val(fen);
                    pgnEl.empty();
                    pgnEll.empty();
                    updateStatus();
                    swal("Success", "FEN parsed successfully.", "success");
                } else {
                    console.log(fenCheck.error);
                    swal.showInputError("ERROR: " + fenCheck.error);
                    return false;
                }
            });
        });

        $("#setPGN").on('click', (function(e) {
            swal({
                title: "SET PGN",
                text: "Enter a game PGN below:",
                type: "input",

                showCancelButton: true,
                closeOnConfirm: false
            }, function(pgn) {
                if (pgn === false) {
                    return; // cancel
                }
                pgn = pgn.trim();
                console.log(pgn);
                var pgnGame = new Chess();
                if (pgnGame.load_pgn(pgn)) {
                    game = pgnGame;
                    var fen = game.fen();
                    console.log("GUI: ucinewgame");
                    engine.postMessage('ucinewgame');
                    console.log("GUI: position fen " + fen);
                    engine.postMessage('position fen ' + game.fen());
                    board.position(fen, false);
                    fenEl.val(game.fen());
                    pgnEl.empty();
                    pgnEll.empty();
                    moveList = game.history();
                    scoreList = [];
                    for (var i = 0; i < moveList.length; i++) {
                        scoreList.push(0);
                    }
                    cursor = moveList.length;
                    updateStatus();
                    swal("Success", "PGN parsed successfully.", "success");
                } else {
                    swal.showInputError("PGN not valid.");
                    return false;
                }
            });
        }));

        $("#resetBtn").on('click', function(e) {
            player = 'w';
            game = new Chess();
            fenEl.empty();
            pgnEl.empty();
            pgnEll.empty();
            largestPGN = '';
            moveList = [];
            scoreList = [];
            cursor = 0;
            board.start();
            board.orientation('white');
            console.log("GUI: ucinewgame");
            engine.postMessage('ucinewgame');
            updateScoreGauge(0);
        });

        $("#engineMenu").change(function() {
            console.log($("#engineMenu").val());
            if (engine) {
                var jsURL = $("#engineMenu").val();
                engine.terminate();
                engine = new Worker(jsURL);
                console.log("GUI: uci");
                engine.postMessage('uci');
                console.log("GUI: ucinewgame");
                engine.postMessage('ucinewgame');
                updateScoreGauge(0); // they each act a little differently
                if (jsURL.match(/p4wn/)) {
                    swal('Using the tiny p4wn engine, which plays at an amateur level.');
                } else if (jsURL.match(/lozza/)) {
                    swal('Using Lozza engine by Colin Jerkins, estimated rating 2340.')
                } else if (jsURL.match(/stockfish/)) {
                    swal("Using stockfish engine, estimated rating > 3000.");
                }
            }
        });

        $('#piecesMenu').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#piecesMenu').val(), '3D', '');
            board.position(fen);
            adjustBoardWidth();
        });

        $('#piece-style').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#piece-style').val(), '2D', 'piece');
            board.position(fen);
            adjustBoardWidth();
        });
        $('#board-style').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#board-style').val(), '2D', 'board');
            board.position(fen);
            adjustBoardWidth();
        });

        updateStatus();

    });


    function onChooseFile(event, onLoadFileHandler) {
        if (typeof window.FileReader !== 'function')
            throw ("The file API isn't supported on this browser.");
        let input = event.target;
        if (!input)
            throw ("The browser does not properly implement the event object");
        if (!input.files)
            throw ("This browser does not support the `files` property of the file input.");
        if (!input.files[0])
            return undefined;
        let file = input.files[0];
        let fr = new FileReader();
        fr.onload = onLoadFileHandler;
        fr.readAsText(file);
        console.log(fr);
    }


    function onFileLoad(elementId, event, args) {
        var engine = new Worker("/static/js/stockfish.js");
        console.log("GUI: uci");
        engine.postMessage("uci");
        console.log("GUI: ucinewgame");
        engine.postMessage("ucinewgame");

        var moveList = [],
            scoreList = [];

        var cursor = 0;

        var player = 'w';
        var entirePGN = ''; // longer than current PGN when rewind buttons are clicked

        var board;
        var game = new Chess(), // move validation, etc.
            statusEl = $('#status'),
            fenEl = $('#fen'),
            pgnEl = $('#pgn');
        pgnEll = $('#pgn1');
        var whiteSquareGrey = '#a9a9a9';
        var blackSquareGrey = '#696969';
        // true for when the engine is processing; ignore_mouse_events is always true if this is set (also during animations)
        var engineRunning = false;

        // don't let the user press buttons while other button clicks are still processing
        var board3D = ChessBoard3.webGLEnabled();

        if (!board3D) {
            swal("WebGL unsupported or disabled.", "Using a 2D board...");
            $('#dimensionBtn').remove();
        }

        var scoreGauge = $('#gauge').SonicGauge({
            label: 'WHITE\'S ADVANTAGE\n(centipawns)',
            start: {
                angle: -230,
                num: -2000
            },
            end: {
                angle: 50,
                num: 2000
            },
            markers: [{
                gap: 200,
                line: {
                    "width": 11,
                    "stroke": "none",
                    "fill": "#cccccc"
                },
                text: {
                    "space": -20,
                    "text-anchor": "middle",
                    "fill": "#cccccc",
                    "font-size": 8
                }
            }, {
                gap: 100,
                line: {
                    "width": 9,
                    "stroke": "none",
                    "fill": "#999999"
                }
            }, {
                gap: 50,
                line: {
                    "width": 7,
                    "stroke": "none",
                    "fill": "#888888"
                }
            }],
            animation_speed: 200,
            diameter: 250,
            style: {
                label: {
                    "font-size": 9,
                    fill: '#cccccc'
                },
                center: {
                    fill: 'r#f46a3a-#890b0b'
                },
                outline: {
                    fill: 'r#888888-#000000',
                    stroke: 'black',
                    'stroke-width': 1
                }
            }
        });

        function updateScoreGauge(score) {
            document.getElementById('setVal').value = score;

            var $p = $('.progress1');
            var $input = $('input');

            if (score >= 0) {

                if (score <= 2500 && score > 0) {

                    $p.css({
                        width: 180 + score + 'px',
                        backgroundPosition: score + 'px'
                    });
                }
            }
            if (score < 0) {

                if (score < 0 && score > -2500) {
                    if (score > -180) {
                        var tt = (180) + (score);


                    } else {
                        var t = (180) + (score);
                        var tt = 180 + (t);


                    }
                    $p.css({

                        width: tt + 'px',
                        backgroundPosition: tt + 'px'
                    });
                }
            }




            scoreGauge.SonicGauge('val', parseInt(score, 10));
        }

        function adjustBoardWidth() {
            var fudge = 250;
            var windowWidth = $(window).width();
            var windowHeight = $(window).height();
            var desiredBoardWidth = $('.one1').outerWidth(true);
            var desiredBoardHeight = windowHeight - $('#header').outerHeight(true) - $('#banner').outerHeight(true) - $('#footer').outerHeight(true) - fudge;

            var boardDiv = $('#board');
            if (board3D) {
                // Using chessboard3.js.
                // Adjust for 4:3 aspect ratio
                desiredBoardWidth &= 0xFFFC; // mod 4 = 0
                desiredBoardHeight -= (desiredBoardHeight % 3); // mod 3 = 0
                if (desiredBoardWidth * 0.75 > desiredBoardHeight) {
                    desiredBoardWidth = desiredBoardHeight * 4 / 3;
                }
                boardDiv.css('width', '85%');
                boardDiv.css('height', '65%');
            } else {
                // This is a chessboard.js board. Adjust for 1:1 aspect ratio
                desiredBoardWidth = Math.min(desiredBoardWidth, desiredBoardHeight);
                boardDiv.css('width', '100%');
                boardDiv.css('height', '100%');
            }
            if (board !== undefined) {
                board.resize();
            }
        }

        function fireEngine() {
            engineRunning = true;
            updateStatus();
            var currentScore;
            var msg = "position fen " + game.fen();
            console.log("GUI: " + msg);
            engine.postMessage(msg);
            msg = 'go movetime ' + $('#moveTime').val();
            console.log("GUI: " + msg);
            engine.postMessage(msg);
            engine.onmessage = function(event) {
                var line = event.data;

                console.log("ENGINE: " + line);
                var best = parseBestMove(line);
                if (best !== undefined) {
                    var move = game.move(best);
                    moveList.push(move);
                    if (currentScore !== undefined) {
                        if (scoreList.length > 0) {
                            scoreList.pop(); // remove the dummy score for the user's prior move
                            scoreList.push(currentScore); // Replace it with the engine's opinion
                        }
                        scoreList.push(currentScore); // engine's response
                    } else {
                        scoreList.push(0); // not expected
                    }
                    cursor++;
                    board.position(game.fen(), true);
                    engineRunning = false;
                    updateStatus();
                } else {
                    // Before the move gets here, the engine emits info responses with scores
                    var score = parseScore(line);
                    if (score !== undefined) {
                        if (player === 'w') {
                            score = -score; // convert from engine's score to white's score
                        }
                        updateScoreGauge(score);
                        currentScore = score;
                    }
                }
            };
        }

        function parseBestMove(line) {
            var match = line.match(/bestmove\s([a-h][1-8][a-h][1-8])(n|N|b|B|r|R|q|Q)?/);
            if (match) {
                var bestMove = match[1];
                var promotion = match[2];
                return {
                    from: bestMove.substring(0, 2),
                    to: bestMove.substring(2, 4),
                    promotion: promotion
                }
            }
        }

        function parseScore(line) {
            var match = line.match(/score\scp\s(-?\d+)/);
            if (match) {
                return match[1];
            } else {
                if (line.match(/mate\s-?\d/)) {
                    return 2500;
                }
            }
        }






        function updateStatus() {

            var status = '';

            var moveColor = 'White';
            if (game.turn() === 'b') {
                moveColor = 'Black';
            }

            if (game.game_over()) {

                if (game.in_checkmate()) {
                    status = moveColor + ' checkmated.';
                } else if (game.in_stalemate()) {
                    status = moveColor + " stalemated";
                } else if (game.insufficient_material()) {
                    status = "Draw (insufficient material)."
                } else if (game.in_threefold_repetition()) {
                    status = "Draw (threefold repetition)."
                } else if (game.in_draw()) {
                    status = "Game over (fifty move rule)."
                }
                swal({
                    title: "Game Over",
                    text: status,
                    type: 'info',
                    showCancelButton: false,
                    confirmButtonColor: "#DD6655",
                    onConfirmButtonText: 'OK',
                    closeOnConfirm: true
                });
                engineRunning = false;
            }

            // game still on
            else {
                if (player === 'w') {
                    status = "Computer playing Black; ";
                } else {
                    status = "Computer playing White; ";
                }
                status += moveColor + ' to move.';

                // check?
                if (game.in_check() === true) {
                    status += ' ' + moveColor + ' is in check.';
                }
            }

            fenEl.html(game.fen().replace(/ /g, '&nbsp;'));
            var currentPGN = game.pgn({
                max_width: 10,
                newline_char: "<br>"
            });
            var matches = entirePGN.lastIndexOf(currentPGN, 0) === 0;
            if (matches) {
                currentPGN += "<span>" + entirePGN.substring(currentPGN.length, entirePGN.length) + "</span>";
            } else {
                entirePGN = currentPGN;
            }
            pgnEl.html(currentPGN);
            if (engineRunning) {
                // status += ' Thinking...';
                status += ' ';
            }
            pgnEll.html(currentPGN);
            if (engineRunning) {
                // status += ' Thinking...';
                status += ' ';
            }
            statusEl.html(status);
        };

        // Set up chessboard
        var onDrop = function(source, target) {

            if (engineRunning) {
                return 'snapback';
            }

            if (board.hasOwnProperty('removeGreySquares') && typeof board.removeGreySquares === 'function') {
                board.removeGreySquares();
            }

            // see if the move is legal
            var move = game.move({
                from: source,
                to: target,
                promotion: 'q' //$("#promotion").val()
            });



            // illegal move
            if (move === null) return 'snapback';
            // highlight black's move

            removeHighlights('white')
            $board.find('.square-' + source).addClass('highlight-white')
            $board.find('.square-' + target).addClass('highlight-white')

            if (cursor === 0) {
                console.log("GUI: ucinewgame");
                engine.postMessage("ucinewgame");
            }
            moveList = moveList.slice(0, cursor);
            scoreList = scoreList.slice(0, cursor);
            moveList.push(move);
            // User just made a move- add a dummy score for now. We will correct this element once we hear from the engine
            scoreList.push(scoreList.length === 0 ? 0 : scoreList[scoreList.length - 1]);
            cursor = moveList.length;
        };
        var $board = $('#board')
        var squareClass = 'square-55d63'

        function removeHighlights(color) {
            $board.find('.' + squareClass)
                .removeClass('highlight-' + color)
        }
        // update the board position after the piece snap
        // for castling, en passant, pawn promotion
        var onSnapEnd = function() {

            if (!game.game_over() && game.turn() !== player) {
                fireEngine();
            }

        };

        var squareToHighlight = null

        function onMouseoverSquare(square, piece) {
            // get list of possible moves for this square
            var moves = game.moves({
                square: square,
                verbose: true
            })

            // exit if there are no moves available for this square
            if (moves.length === 0) {
                ondragpostion(square);
            }

            // highlight the square they moused over
            greySquare(square)

            // highlight the possible squares for this piece
            for (var i = 0; i < moves.length; i++) {
                board.addArrowAnnotation(square, moves[i].to)
                greySquare(moves[i].to)
            }
        }



        function ondragpostion(square) {
            //board.addArrowAnnotation(square, "h5"); 
        }

        function onMouseoutSquare(square, piece) {
            board.clearAnnotation()
            removeGreySquares()
        }

        function removeGreySquares() {
            $('#board .square-55d63').css('background', '')
        }

        function greySquare(square) {
            // alert(square);
            var square = $('#board .square-' + square)

            var background = whiteSquareGrey
            if (square.hasClass('black-3c85d')) {
                background = blackSquareGrey
            }

            square.css('background', background)


        }



        function onMoveEnd() {
            $board.find('.square-' + squareToHighlight)
                .addClass('highlight-black')
        }

        function createBoard(pieceSet, args, args1, args2) {
            // alert(pieceSet+"->"+args);
            var cfg = {

                cameraControls: true,
                draggable: true,
                position: 'start',
                onDrop: onDrop,
                onMouseoutSquare: onMouseoutSquare,
                onMouseoverSquare: onMouseoverSquare,
                onSnapEnd: onSnapEnd,
                onMoveEnd: onMoveEnd
                    //overlay: true
            };

            // if (board3D) {
            //     if (pieceSet) {
            //         if (pieceSet === 'minions') {
            //             cfg.whitePieceColor = 0xFFFF00;
            //             cfg.blackPieceColor = 0xCC00CC;
            //             cfg.lightSquareColor = 0x888888;
            //             cfg.darkSquareColor = 0x666666;
            //         }
            //         cfg.pieceSet = '/static/assets/chesspieces/' + pieceSet + '/{piece}.json';
            //     }
            //     return new ChessBoard3('board', cfg);
            //   } else {
            if (args == '2D') {
                if (args1 == 'piece') {
                    var selectedVal = $("#board-style option:selected").val();
                    if (selectedVal == 'aluminium') {

                        // cfg.boardTheme = ["#6fadd4", "#d0ceca"];

                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/ab.png')", "url('/static/img/chesspieces/board/aw.png')", "url('/static/img/chesspieces/board/ab.png')"]

                        });
                    }
                    if (selectedVal == 'cherry') {

                        //cfg.boardTheme = ["#521b01", "#b45119"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/cherry1.png')", "url('/static/img/chesspieces/board/cherry2.png')", "url('/static/img/chesspieces/board/cherry2.png')"]

                        });
                    }
                    if (selectedVal == 'lapis') {

                        //cfg.boardTheme = ["#244251", "#c9b46b"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/wb.png')", "url('/static/img/chesspieces/board/ww.png')", "url('/static/img/chesspieces/board/wb.png')"]

                        });
                    }
                    if (selectedVal == 'marble') {

                        //cfg.boardTheme = ["#bb886e", "#e9d2b7"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/marble1.png')", "url('/static/img/chesspieces/board/marble2.png')", "url('/static/img/chesspieces/board/marble1.png')"]

                        });
                    }
                    if (selectedVal == 'sand') {

                        //cfg.boardTheme = ["#c8a97d", "#fdedb7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/sand1.png')", "url('/static/img/chesspieces/board/sand2.png')", "url('/static/img/chesspieces/board/sand1.png')"],
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png'
                        });
                    }
                    if (selectedVal == 'slate') {

                        //cfg.boardTheme = ["#8c8c8c", "#c9c9c9"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/slate1.png')", "url('/static/img/chesspieces/board/slate2.png')", "url('/static/img/chesspieces/board/slate2.png')"]

                        });
                    } else {
                        //cfg.boardTheme = ["#ae6c37", "#d4b171"];#244251", "#c9b46b

                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/lapis/lapis1.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')"]


                        });

                    }



                    //cfg.pieceTheme = '/static/img/chesspieces/' + pieceSet + '/{piece}.png';


                    //return new ChessBoard('board', cfg);
                }
                if (args1 == 'board') {
                    if (pieceSet == 'aluminium') {
                        // cfg.boardTheme = ["#6fadd4", "#d0ceca"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/ab.png')", "url('/static/img/chesspieces/board/aw.png')", "url('/static/img/chesspieces/board/ab.png')"]

                        });
                    }
                    if (pieceSet == 'cherry') {

                        //cfg.boardTheme = ["#521b01", "#b45119"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/cherry1.png')", "url('/static/img/chesspieces/board/cherry2.png')", "url('/static/img/chesspieces/board/cherry2.png')"]

                        });
                    }
                    if (pieceSet == 'lapis') {

                        //cfg.boardTheme = ["#244251", "#c9b46b"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/wb.png')", "url('/static/img/chesspieces/board/ww.png')", "url('/static/img/chesspieces/board/wb.png')"]

                        });
                    }
                    if (pieceSet == 'marble') {

                        //cfg.boardTheme = ["#bb886e", "#e9d2b7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/marble1.png')", "url('/static/img/chesspieces/board/marble2.png')", "url('/static/img/chesspieces/board/marble1.png')"]

                        });
                    }
                    if (pieceSet == 'sand') {

                        //cfg.boardTheme = ["#c8a97d", "#fdedb7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/sand1.png')", "url('/static/img/chesspieces/board/sand2.png')", "url('/static/img/chesspieces/board/sand1.png')"]

                        });
                    }
                    if (pieceSet == 'slate') {

                        //cfg.boardTheme = ["#8c8c8c", "#c9c9c9"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/slate1.png')", "url('/static/img/chesspieces/board/slate2.png')", "url('/static/img/chesspieces/board/slate2.png')"]

                        });
                    }
                    return new ChessBoard('board', cfg);
                }

            } else {
                //cfg.boardTheme = ["#ae6c37", "#d4b171"];#244251", "#c9b46b

                return new ChessBoard('board', {
                    draggable: true,
                    position: 'start',
                    onDrop: onDrop,
                    onSnapEnd: onSnapEnd,
                    boardTheme: ["url('/static/img/chesspieces/board/lapis/lapis1.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')"]


                });

            }
        }



        adjustBoardWidth();
        board = createBoard();

        $(window).resize(function() {
            adjustBoardWidth();
        });

        // Set up buttons
        $('#startBtn').on('click', function() {
            var cursorStart = 0;
            if (player === 'b') {
                cursorStart = 1;
            }
            while (cursor > cursorStart) {
                game.undo();
                cursor--;
            }
            updateScoreGauge(0);
            board.position(game.fen());
            updateStatus();
        });
        $('#backBtn').on('click', function() {
            if (cursor > 0) {
                cursor--;
                game.undo();
                board.position(game.fen());
                var score = cursor === 0 ? 0 : scoreList[cursor - 1];
                updateScoreGauge(score);
                updateStatus();
            }
        });
        $('#forwardBtn').on('click', function() {
            if (cursor < moveList.length) {
                game.move(moveList[cursor]);
                var score = scoreList[cursor];
                updateScoreGauge(score);
                board.position(game.fen());
                cursor++;
                updateStatus();
            }
        });
        var pause_value = "play";
        $('#playBtn').on('click', function() {
            pause_value = "play";
            if (pause_value == "play") {
                play();
            } else {
                if (pause_value == "pause") {
                    stop();
                } else {
                    return;
                }
            }

        });

        function play() {
            var k = moveList.length;
            document.getElementById('movecount').value = k;
            // var pause = document.getElementById('playcount').value;
            var me = this;
            var delay = 1000;
            var timerId = null;
            var moveId = 0;
            for (i = k; i > 0; i--) {
                document.getElementById('movecount').value = i;
                setTimeout(function timer() {
                    if (pause_value == 'pause') {

                    } else {

                        game.move(moveList[cursor]);
                        var score = scoreList[cursor];
                        board.position(game.fen());
                        cursor++;
                        updateStatus();
                        updateScoreGauge(score);
                    }

                }, i * delay);

            }
        }
        $('#pause').on('click', function() {
            pause_value = "pause";
            document.getElementById("board").disabled = true;
            if (pause_value == "play") {
                play();
            } else {
                //pause_value="play";
            }

        });

        function stop() {}
        $('#endBtn').on('click', function() {
            while (cursor < moveList.length) {
                game.move(moveList[cursor++]);
            }
            board.position(game.fen());
            updateScoreGauge(scoreList.length == 0 ? 0 : scoreList[cursor - 1]);
            updateStatus();
        });
        $('#hintBtn').on('click', function() {
            if (game.turn() === player) {
                engineRunning = true;
                var msg = "position fen " + game.fen();
                console.log("GUI: " + msg);
                engine.postMessage(msg);
                msg = 'go movetime ' + $('#moveTime').val();
                console.log(msg);
                engine.postMessage(msg);
                engine.onmessage = function(event) {
                    console.log("ENGINE: " + event.data);
                    var best = parseBestMove(event.data);
                    if (best !== undefined) {
                        var currentFEN = game.fen();
                        game.move(best);
                        var hintedFEN = game.fen();
                        game.undo();
                        board.position(hintedFEN, true);
                        // give them a second to look before sliding the piece back
                        setTimeout(function() {
                            board.position(currentFEN, true);
                            engineRunning = false;
                        }, 1000); // give them a second to look
                    }
                }
            }
        });
        $('#flipBtn').on('click', function() {
            if (game.game_over()) {
                return;
            }
            board.flip(); //wheeee!
            if (player === 'w') {
                player = 'b';
            } else {
                player = 'w';
            }
            updateStatus();
            setTimeout(fireEngine, 1000);
        });

        $('#dimensionBtn').on('click', function() {
            var dimBtn = $("#dimensionBtn");
            var sel = document.getElementById('dimensionBtn').value;
            dimBtn.prop('disabled', true);
            var position = board.position();
            var orientation = board.orientation();
            board.destroy();
            board3D = !board3D;
            adjustBoardWidth();
            if (sel == '3D') {

                dimBtn.val(board3D ? '3D' : '2D');
                setTimeout(function() {

                    board = createBoard($('#piecesMenu').val(), sel);
                    board.orientation(orientation);
                    board.position(position);
                    $("#dimensionBtn").prop('disabled', false);
                });
            }
            if (sel == '2D') {
                setTimeout(function() {

                    board = createBoard($('#piece-style').val(), sel);
                    console.log(board);
                    board.orientation(orientation);
                    board.position(position);
                    $("#dimensionBtn").prop('disabled', false);

                });
            }


        });


        $("#setFEN").on('click', function(e) {
            swal({
                title: "SET FEN",
                text: "Enter a FEN position below:",
                type: "input",
                inputType: "text",
                showCancelButton: true,
                closeOnConfirm: false
            }, function(fen) {
                if (fen === false) {
                    return; //cancel
                }
                fen = fen.trim();
                console.log(fen);
                var fenCheck = game.validate_fen(fen);
                console.log("valid: " + fenCheck.valid);
                if (fenCheck.valid) {
                    game = new Chess(fen);
                    console.log("GUI: ucinewgame");
                    engine.postMessage('ucinewgame');
                    console.log("GUI: position fen " + fen);
                    engine.postMessage('position fen ' + fen);
                    board.position(fen);
                    fenEl.val(fen);
                    pgnEl.empty();
                    pgnEll.empty();
                    updateStatus();
                    swal("Success", "FEN parsed successfully.", "success");
                } else {
                    console.log(fenCheck.error);
                    swal.showInputError("ERROR: " + fenCheck.error);
                    return false;
                }
            });
        });

        $("#setPGN").on('click', (function(e) {
            swal({
                title: "SET PGN",
                text: "Enter a game PGN below:",
                type: "input",

                showCancelButton: true,
                closeOnConfirm: false
            }, function(pgn) {
                if (pgn === false) {
                    return; // cancel
                }
                pgn = pgn.trim();
                console.log(pgn);
                var pgnGame = new Chess();
                if (pgnGame.load_pgn(pgn)) {
                    game = pgnGame;
                    var fen = game.fen();
                    console.log("GUI: ucinewgame");
                    engine.postMessage('ucinewgame');
                    console.log("GUI: position fen " + fen);
                    engine.postMessage('position fen ' + game.fen());
                    board.position(fen, false);
                    fenEl.val(game.fen());
                    pgnEl.empty();
                    pgnEll.empty();
                    moveList = game.history();
                    scoreList = [];
                    for (var i = 0; i < moveList.length; i++) {
                        scoreList.push(0);
                    }
                    cursor = moveList.length;
                    updateStatus();
                    swal("Success", "PGN parsed successfully.", "success");
                } else {
                    swal.showInputError("PGN not valid.");
                    return false;
                }
            });
        }));

        $("#resetBtn").on('click', function(e) {
            player = 'w';
            game = new Chess();
            fenEl.empty();
            pgnEl.empty();
            pgnEll.empty();
            largestPGN = '';
            moveList = [];
            scoreList = [];
            cursor = 0;
            board.start();
            board.orientation('white');
            console.log("GUI: ucinewgame");
            engine.postMessage('ucinewgame');
            updateScoreGauge(0);
        });

        $("#engineMenu").change(function() {
            console.log($("#engineMenu").val());
            if (engine) {
                var jsURL = $("#engineMenu").val();
                engine.terminate();
                engine = new Worker(jsURL);
                console.log("GUI: uci");
                engine.postMessage('uci');
                console.log("GUI: ucinewgame");
                engine.postMessage('ucinewgame');
                updateScoreGauge(0); // they each act a little differently
                if (jsURL.match(/p4wn/)) {
                    swal('Using the tiny p4wn engine, which plays at an amateur level.');
                } else if (jsURL.match(/lozza/)) {
                    swal('Using Lozza engine by Colin Jerkins, estimated rating 2340.')
                } else if (jsURL.match(/stockfish/)) {
                    swal("Using stockfish engine, estimated rating > 3000.");
                }
            }
        });

        $('#piecesMenu').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#piecesMenu').val(), '3D', '');
            board.position(fen);
            adjustBoardWidth();
        });

        $('#piece-style').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#piece-style').val(), '2D', 'piece');
            board.position(fen);
            adjustBoardWidth();
        });
        $('#board-style').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#board-style').val(), '2D', 'board');
            board.position(fen);
            adjustBoardWidth();
        });

        updateStatus();
        //document.getElementById("pgn1").innerText = event.target.result;
        document.getElementById("pgn").innerText = event.target.result;
        pgn = event.target.result;
        var board;
        fenEl = $('#fen');



        pgn = pgn.trim();
        console.log(pgn);
        var pgnGame = new Chess();
        if (pgnGame.load_pgn(pgn)) {
            game = pgnGame;
            var fen = game.fen();
            console.log("GUI: ucinewgame");
            engine.postMessage('ucinewgame');
            console.log("GUI: position fen " + fen);
            engine.postMessage('position fen ' + game.fen());
            board.position(game.fen());
            fenEl.val(game.fen());
            pgnEl.empty();
            pgnEll.empty();
            moveList = game.history();
            scoreList = [];
            for (var i = 0; i < moveList.length; i++) {
                scoreList.push(0);
            }
            cursor = moveList.length;

            swal("Success", "PGN parsed successfully.", "success");
        } else {
            swal.showInputError("PGN not valid.");
            return false;
        }



    }

    function hideplay() {
        $('#playBtn').hide();
        $('#pause').css('display', 'initial');
        document.getElementById('playcount').value = 0;

    }

    function showplay() {
        $('#pause').css('display', 'none');
        $('#playBtn').show();

        document.getElementById('playcount').value = 1;
    }

    function download(file, text) {

        //creating an invisible element 
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8, ' +
            encodeURIComponent(text));
        element.setAttribute('download', file);

        //the above code is equivalent to 
        // <a href="path of file" download="file name"> 

        document.body.appendChild(element);

        //onClick property 
        element.click();

        document.body.removeChild(element);
    }

    function uploadPGN(){
       alert(document.getElementById("pgn").innerText);
       $('#fd_pgn').val(document.getElementById("pgn").innerText);
       $("#upload_pgn").submit();
    }

    // Start file download. 
    document.getElementById("export").addEventListener("click", function() {
        // Generate download of hello.txt file with some content 
        var text = document.getElementById("pgn").innerText;
        var filename = "chessmove.pgn";

        download(filename, text);
        //uploadPGN();
    }, false);
</script>



<script>
    function setSquaresColor(args, args1, args2) {
        console.log(args2);
        $('.white-1e1d7').css('background', args);
        $('.black-3c85d').css('background', args1);
        $('.board-b72b1').css('background', args2);
    }
</script>


<script>
    /*active button class onclick*/
    $('nav a').click(function(e) {
        e.preventDefault();
        $('nav a').removeClass('active');
        $(this).addClass('active');
        if (this.id === !'payment') {
            $('.payment').addClass('noshow');
            document.getElementById("profile").style.zIndex = "-1";
            document.getElementById("subscription").style.zIndex = "-11";
        } else if (this.id === 'payment') {
            $('.payment').removeClass('noshow');
            $('.rightbox').children().not('.payment').addClass('noshow');
            // alert("akshat");
            // document.getElementById("profile").style.zIndex = "-1";
            // document.getElementById("subscription").style.zIndex = "-11";
            // $('.profile').css("z-index","-1");
            $("#payment_ss").css("opacity", "1");
            $('.payment').css("z-index", "1");
            $('.settings').css("z-index", "-1");
            $(".settings").css("opacity", "0");
        } else if (this.id === 'profile') {
            $('.profile').removeClass('noshow');
            $('.settings').css("z-index", "-1");
            $(".profile").css("opacity", "1");
            $('.payment').css("z-index", "-1");
            $('.rightbox').children().not('.profile').addClass('noshow');
        } else if (this.id === 'subscription') {
            $('.subscription').removeClass('noshow');
            $('.subscription').css("z-index", "1");
            $('.payment').css("z-index", "-1");
            $('.rightbox').children().not('.subscription').addClass('noshow');
        } else if (this.id === 'privacy') {
            $('.privacy').removeClass('noshow');
            $('.subscription').css("z-index", "-1");
            $('.payment').css("z-index", "-1");
            $('.privacy').css("z-index", "1");
            $('.rightbox').children().not('.privacy').addClass('noshow');
        } else if (this.id === 'settings') {
            $('.settings').removeClass('noshow');
            $("#payment_ss").css("opacity", "0");
            $(".settings").css("opacity", "1");

            $('.payment').css("z-index", "-1");
            $('.settings').css("z-index", "1");
            $('.rightbox').children().not('.settings').addClass('noshow');
        }
    });
</script>
<script>
    $('.Show').click(function() {
        $('#target').show(500);
        $('.Show').hide(0);
        $('.Hide').show(0);
        $('.profile').hide(0);
        $('.payment').show(0);
        $("#payment_ss").css("opacity", "1");
        $('.payment').css("z-index", "1");
        $('.settings').css("z-index", "-1");
    });
    $('.Hide').click(function() {
        $('#target').hide(500);
        $('.Show').show(0);
        $('.Hide').hide(0);
        $('.payment').hide(0);
        $('.profile').show(0);
        $(".profile").css("opacity", "1");
        $(".settings").css("opacity", "0");

    });
</script>
<script>
    $('.SHOW').click(function() {
        //$('#tar').show(500);
        $('#tar').hide(500);
        $('.SHOW').hide(0);
        $('.HIDE').show(0);
    });
    $('.HIDE').click(function() {
        $('#tar').show(500);
        $('.SHOW').show(0);
        $('.HIDE').hide(0);
    });
</script>

<!-- <script>
    /*  2009 ROBO Design
     * http://www.robodesign.ro
     */

    // Keep everything in anonymous function, called on window load.
    var color = "green";
    if (window.addEventListener) {
        window.addEventListener('load', function() {
            var canvas, context, canvaso, contexto;
            var headlen = 10;
            var tool;
            var tool_default = 'line';

            function init() {
                // Find the canvas element.
                canvaso = document.getElementById('imageView');
                if (!canvaso) {
                    alert('Error: I cannot find the canvas element!');
                    return;
                }

                if (!canvaso.getContext) {
                    alert('Error: no canvas.getContext!');
                    return;
                }

                // Get the 2D canvas context.
                contexto = canvaso.getContext('2d');
                if (!contexto) {
                    alert('Error: failed to getContext!');
                    return;
                }

                // Add the temporary canvas.
                var container = canvaso.parentNode;
                canvas = document.createElement('canvas');
                if (!canvas) {
                    alert('Error: I cannot create a new canvas element!');
                    return;
                }

                canvas.id = 'imageTemp';
                canvas.width = canvaso.width;
                canvas.height = canvaso.height;
                container.appendChild(canvas);

                context = canvas.getContext('2d');

                // Get the tool select input.
                var tool_select = document.getElementById('dtool');
                if (!tool_select) {
                    alert('Error: failed to get the dtool element!');
                    return;
                }
                tool_select.addEventListener('change', ev_tool_change, false);

                // Activate the default tool.
                if (tools[tool_default]) {
                    tool = new tools[tool_default]();
                    tool_select.value = tool_default;
                }

                // Attach the mousedown, mousemove and mouseup event listeners.
                canvas.addEventListener('mousedown', ev_canvas, false);
                canvas.addEventListener('mousemove', ev_canvas, false);
                canvas.addEventListener('mouseup', ev_canvas, false);
            }

            // The general-purpose event handler. This function just determines the mouse 
            // position relative to the canvas element.
            function ev_canvas(ev) {
                if (ev.layerX || ev.layerX == 0) { // Firefox
                    ev._x = ev.layerX;
                    ev._y = ev.layerY;
                } else if (ev.offsetX || ev.offsetX == 0) { // Opera
                    ev._x = ev.offsetX;
                    ev._y = ev.offsetY;
                }

                // Call the event handler of the tool.
                var func = tool[ev.type];
                if (func) {
                    func(ev);
                }
            }

            // The event handler for any changes made to the tool selector.
            function ev_tool_change(ev) {
                if (tools[this.value]) {
                    tool = new tools[this.value]();
                }
            }

            // This function draws the #imageTemp canvas on top of #imageView, after which 
            // #imageTemp is cleared. This function is called each time when the user 
            // completes a drawing operation.
            function img_update() {
                contexto.drawImage(canvas, 0, 0);
                context.clearRect(0, 0, canvas.width, canvas.height);
            }

            // This object holds the implementation of each drawing tool.
            var tools = {};

            // The drawing pencil.
            tools.pencil = function() {
                var tool = this;
                this.started = false;

                // This is called when you start holding down the mouse button.
                // This starts the pencil drawing.
                this.mousedown = function(ev) {
                    context.beginPath();
                    context.moveTo(ev._x, ev._y);
                    tool.started = true;
                };

                // This function is called every time you move the mouse. Obviously, it only 
                // draws if the tool.started state is set to true (when you are holding down 
                // the mouse button).
                this.mousemove = function(ev) {
                    if (tool.started) {
                        context.lineTo(ev._x, ev._y);
                        context.stroke();
                        context.fill();
                    }
                };

                // This is called when you release the mouse button.
                this.mouseup = function(ev) {
                    if (tool.started) {
                        tool.mousemove(ev);
                        tool.started = false;
                        img_update();
                    }
                };
            };

            // The rectangle tool.
            tools.rect = function() {
                var tool = this;
                this.started = false;

                this.mousedown = function(ev) {
                    tool.started = true;
                    tool.x0 = ev._x;
                    tool.y0 = ev._y;
                };

                this.mousemove = function(ev) {
                    if (!tool.started) {
                        return;
                    }

                    var x = Math.min(ev._x, tool.x0),
                        y = Math.min(ev._y, tool.y0),
                        w = Math.abs(ev._x - tool.x0),
                        h = Math.abs(ev._y - tool.y0);
                    //alert;
                    context.clearRect(0, 0, canvas.width, canvas.height);

                    if (!w || !h) {
                        return;
                    }

                    context.strokeRect(x, y, w, h);
                };

                this.mouseup = function(ev) {
                    if (tool.started) {
                        tool.mousemove(ev);
                        tool.started = false;
                        img_update();
                    }
                };
            };

            // The line tool.
            tools.line = function() {
                var tool = this;
                this.started = false;

                this.mousedown = function(ev) {
                    tool.started = true;
                    tool.x0 = ev._x;
                    tool.y0 = ev._y;
                };
                context.strokeStyle = color;
                context.fillStyle = color;
                context.lineWidth = 5;



                this.mousemove = function(ev) {
                    if (!tool.started) {
                        return;
                    }


                    context.clearRect(0, 0, canvas.width, canvas.height);
                    var angle = Math.atan2(ev._y - tool.y0, ev._x - tool.x0);
                    context.beginPath();
                    context.moveTo(tool.x0, tool.y0);
                    //alert(tool.x0 + 'asdf' + tool.y0);
                    context.lineTo(ev._x, ev._y);
                    //context.lineTo(ev._x, ev._x);
                    context.stroke();
                    context.fill();
                    context.stroke();


                    //starting a new path from the head of the arrow to one of the sides of the point
                    context.beginPath();
                    context.moveTo(ev._x, ev._y);
                    context.lineTo(ev._x - headlen * Math.cos(angle - Math.PI / 7), ev._y - headlen * Math.sin(angle - Math.PI / 7));

                    //path from the side point of the arrow, to the other side point

                    context.lineTo(ev._x - headlen * Math.cos(angle + Math.PI / 7), ev._y - headlen * Math.sin(angle + Math.PI / 7));

                    //path from the side point back to the tip of the arrow, and then again to the opposite side point
                    context.lineTo(ev._x, ev._y);
                    context.lineTo(ev._x - headlen * Math.cos(angle - Math.PI / 7), ev._y - headlen * Math.sin(angle - Math.PI / 7));

                    //draws the paths created above
                    context.strokeStyle = color;
                    context.lineWidth = 22;
                    context.stroke();
                    context.fillStyle = color;
                    context.fill();
                    context.closePath();

                    function clear() {
                        context.clearRect(0, 0, canvas.width, canvas.height);
                    }
                };

                this.mouseup = function(ev) {
                    if (tool.started) {
                        tool.mousemove(ev);
                        tool.started = false;
                        img_update();
                    }
                };
            };

            init();

        }, false);
    }

    function showColor(args) {
        color = args;
    }



    function delete_temp() {

        $('#imageTemp').outerHTML = '';

    }


    // vim:set spell spl=en fo=wan1croql tw=80 ts=2 sw=2 sts=2 sta et ai cin fenc=utf-8 ff=unix:
</script> -->

<script>
    //REPLACE 'container' WITH THE ID OF ELEMENT WHERE TO DRAW ARROWS
    var elm_container = document.querySelector('#contain');

    //Draw arrows with SVG in the $parent element between the click coords
    function drawArrowSVG(parent) {
        //From: https://coursesweb.net/javascript/
        var me = this;
        var x, y = 0; //contain the coordinates
        var drawarrow = 0; //if 2, draw the arrow
        var c_e1 = {}; // x,y coords for base line
        var c_e2 = {}; // x,y coords for arrow
        var container = parent;
        me.draw = -1; //if 1 allow to draw the arrow

        // Get X and Y position of the elm (from: vishalsays.wordpress.com)
        function getXYpos(elm) {
            x = elm.offsetLeft; // set x to elms offsetLeft
            y = elm.offsetTop; // set y to elms offsetTop

            elm = elm.offsetParent; // set elm to its offsetParent

            //use while loop to check if elm is null
            // if not then add current elms offsetLeft to x
            //offsetTop to y and set elm to its offsetParent
            while (elm != null) {
                x = parseInt(x) + parseInt(elm.offsetLeft);
                y = parseInt(y) + parseInt(elm.offsetTop);
                elm = elm.offsetParent;
            }

            // returns an object with "xp" (Left), "=yp" (Top) position
            return {
                'xp': x,
                'yp': y
            };
        }

        // Get X, Y coords
        function getCoords(e) {
            //if $draw is 1, get the coords and draw arrow
            if (me.draw == 1) {
                var xy_pos = getXYpos(this);

                // if IE
                if (navigator.appVersion.indexOf("MSIE") != -1) {
                    // in IE scrolling page affects mouse coordinates into an element
                    // This gets the page element that will be used to add scrolling value to correct mouse coords
                    var standardBody = (document.compatMode == 'CSS1Compat') ? document.documentElement : document.body;

                    x = event.clientX + standardBody.scrollLeft;
                    y = event.clientY + standardBody.scrollTop;
                } else {
                    x = e.pageX;
                    y = e.pageY;
                }

                x = x - xy_pos['xp'];
                y = y - xy_pos['yp'];

                //set coords in c_e2 and c_e1; if drawarrow is 2 draw the arrow
                drawarrow++;
                if (drawarrow == 2) {
                    c_e2 = {
                        x: x,
                        y: y
                    };
                    drawarrow = 0;
                    drawArrow(c_e1, c_e2);
                } else c_e1 = {
                    x: x,
                    y: y
                };
            }
        }

        //append in #container SVG arrow with base in $c_e1 and the arrow in $c_e2 coords
        function drawArrow(c_e1, c_e2) {
            var clr = document.getElementById('color').value;
            if (clr == 'green') {
                //<!-- <svg><defs><marker id="arrowhead-g" orient="auto" markerWidth="4" markerHeight="8" refX="2.05" refY="2.01" cgKey="g"><path d="M0,0 V4 L3,2 Z" fill="#15781B"></path></marker><marker id="arrowhead-pb" orient="auto" markerWidth="4" markerHeight="8" refX="2.05" refY="2.01" cgKey="pb"><path d="M0,0 V4 L3,2 Z" fill="#003088"></path></marker></defs><line stroke="#15781B" stroke-width="2.5" stroke-linecap="round" marker-end="url(#arrowhead-g)" opacity="1" x1="40" y1="88" x2="70.23223304703363" y2="57.76776695296637" cgHash="c3e5green"></line><line stroke="#003088" stroke-width="3.75" stroke-linecap="round" marker-end="url(#arrowhead-pb)" opacity="0.4" x1="56" y1="104" x2="56" y2="74.5" cgHash="d2d4paleBlue"></line></svg> -->

                var arrsvg = '<svg class="arrsvg" style="position:absolute; top:0; left:0; margin:0; width:99.8%; height:99.9%;"><defs><marker id="arrow" markerWidth="8" markerHeight="8"  refx="3" refy="4" orient="auto" markerUnits="strokeWidth" viewBox="0 0 16 16"><path id="path1" d="M1,1 L1,7 L7,4 L1,1" fill="green"   stroke=none; /></marker></defs><path stroke-width="12" d="M' + c_e1.x + ',' + c_e1.y + ' L' + c_e2.x + ',' + c_e2.y + '" style="stroke:green;  fill=none; marker-end: url(' + location.href.replace(/[#]*$/ig, '') + '#arrow);"/></svg>';
            }
            if (clr == 'yellow') {
                var arrsvg = '<svg class="arrsvg" style="position:absolute; top:0; left:0; margin:0; width:99.8%; height:99.9%;"><defs><marker id="arrow" markerWidth="8" markerHeight="8" refx="3" refy="4" orient="auto" markerUnits="strokeWidth" viewBox="0 0 16 16"><path id="path1" d="M1,1 L1,7 L7,4 L1,1" fill="yellow"   stroke=none; /></marker></defs><path stroke-width="12" d="M' + c_e1.x + ',' + c_e1.y + ' L' + c_e2.x + ',' + c_e2.y + '" style="stroke:yellow;  fill=none; marker-end: url(' + location.href.replace(/[#]*$/ig, '') + '#arrow);"/></svg>';
            }
            if (clr == 'red') {
                var arrsvg = '<svg class="arrsvg" style="position:absolute; top:0; left:0; margin:0; width:99.8%; height:99.9%;"><defs><marker id="arrow" markerWidth="8" markerHeight="8" refx="3" refy="4" orient="auto" markerUnits="strokeWidth" viewBox="0 0 16 16"><path id="path1" d="M1,1 L1,7 L7,4 L1,1" fill="red"   stroke=none; /></marker></defs><path stroke-width="12" d="M' + c_e1.x + ',' + c_e1.y + ' L' + c_e2.x + ',' + c_e2.y + '" style="stroke:red;  fill=none; marker-end: url(' + location.href.replace(/[#]*$/ig, '') + '#arrow);"/></svg>';
            }

            container.insertAdjacentHTML('beforeend', arrsvg); //add the arrow to the end in #container
            // = '<svg class="arrsvg" style="position:absolute; top:0; left:0; margin:0; width:99.8%; height:99.9%;"><defs><marker id="arrow" markerWidth="8" markerHeight="8" refx="3" refy="4" orient="auto" markerUnits="strokeWidth" viewBox="0 0 16 16"><path d="M1,1 L1,7 L7,4 L1,1" fill=' + clr + ' style="fill:' + clr + ';"  /></marker></defs><path stroke-width="12" d="M' + c_e1.x + ',' + c_e1.y + ' L' + c_e2.x + ',' + c_e2.y + '" style="stroke:' + clr + ';  fill: none; marker-end: url(' + location.href.replace(/[#]*$/ig, '') + '#arrow);"/></svg>';
        }

        //register click on $container to get the coords
        container.addEventListener('click', getCoords);
    }


    //draw arrow with SVG between the clicks coords in $elm_container
    var drawAr = new drawArrowSVG(elm_container);
    //var drawAr1 = new drawArrowSVG(elm_container);
    //var drawAr2 = new drawArrowSVG(elm_container);

    //register click on #btn_drawar to enable /disable drawing action
    var btn_drawar = document.getElementById('btn_drawar');
    if (btn_drawar) btn_drawar.addEventListener('click', function(e) {

        drawAr.draw *= -1;
        //e.target.style.background = (drawAr.draw == 1) ? '#f00' : '#dadafb';
        //e.target.innerHTML = (drawAr1.draw == 1) ? '' : '';

    });



    //register click on #btn_delar to delete arrows
    var btn_delar = document.getElementById('btn_delar');
    if (btn_delar) btn_delar.addEventListener('click', function(e) {


        // drawAr1.draw *= -1;
        //e.target.innerHTML = (drawAr1.draw == 1) ? '' : '';
        //drawAr2.draw *= -1;
        //e.target.innerHTML = (drawAr2.draw == 1) ? '' : '';

        var arrsvg = document.querySelectorAll('.arrsvg');
        for (var i = 0; i < arrsvg.length; i++) arrsvg[i].outerHTML = '';
    });
</script>
<!-- <script>
    //Write the game to the DOM
    //Write the game to the DOM
    function writeGameText(g) {

        //remove the header to get the moves

        var pgn = g.pgn();
        console.log(pgn);
        var gameMoves = pgn.replace(/\[(.*?)\]/gm, '').trim();
        console.log(gameMoves);
        //format the moves so each one is individually identified, so it can be highlighted
        moveArray = gameMoves.split(/([0-9]+\.\s)/).filter(function(n) {
            return n;
        });
        for (var i = 0, l = moveArray.length; i < l; ++i) {
            var s = $.trim(moveArray[i]);
            if (!/^[0-9]+\.$/.test(s)) { //move numbers
                m = s.split(/\s+/);
                console.log(m);
                for (var j = 0, ll = m.length; j < ll; ++j) {
                    m[j] = '<span class="gameMove' + (i + j - 1) + '"><a id="myLink" href="#" onclick="goToMove(' + (i + j - 1) + ');return false;">' + m[j] + '</a></span>';
                }
                s = m.join(' ');
            }
            moveArray[i] = s;
        }

        var gameData = '<div class="gameMoves">' + moveArray.join(' ');

        gameData += ' <span class="gameResult">'
        '</span></div>';
        $("#pgn").html(gameData);

    }



    //key bindings


    //used for clickable moves in gametext
    //not used for buttons for efficiency
    function goToMove(ply) {
        //console.log(ply);
        if (ply > gameHistory.length - 1) ply = gameHistory.length - 1;
        
        for (var i = 0; i <= ply; i++) {
            game.move(gameHistory[i].san);
        }
        currentPly = i - 1;
        board.position(game.fen());
    }

    var onChange = function onChange() { //fires when the board position changes
        //highlight the current move
        $("[class^='gameMove']").removeClass('highlight');
        $('.gameMove' + currentPly).addClass('highlight');
    }
    var moveList = ['1. e4 c6 2. Nf3 d5 3. Nc3 dxe4 4. Nxe4 Bg4 5. h3 Bxf3 6. Qxf3 e6 7. Bc4 Nd7 '];

    function loadGame(i) {
        game = new Chess();
        game.load_pgn(moveList[i], {
            newline_char: '\n'
        });
        writeGameText(game);
        gameHistory = game.history({
            verbose: true
        });
        goToMove(-1);
        currentGame = i;
    }

    var board, //the chessboard
        game, //the current  game
        games, //array of all loaded games
        gameHistory,
        currentPly,
        currentGame;

    $(document).ready(function() {
        //start doing stuff

        //only need the headers here, issue raised on github
        //read all the games to populate the select
        //var moveList = ['d3', 'e5', 'e3', 'd5', 'f3', 'Nc6', 'g3', 'Nf6', 'h3', 'd4', 'c3', 'dxc3'];

        for (var i = 0; i < moveList.length; i++) {
            var g = new Chess();
            g.load_pgn(moveList[i], {
                newline_char: '\n'
            });
        }

        //set up the board
        var cfg = {
            position: 'start',
            showNotation: false,
            onChange: onChange
        };
        board = new ChessBoard('board', cfg);
        $(window).resize(board.resize);

        //load the first game
        loadGame(0);
        goToMove(gameHistory.length - 1);
    });
</script> -->
<div id="content" style="display: none;">
    {% for content in content %}
    <li><a>{{ content.content }}</a></li>
    {% endfor %}
</div>
<script>
    function goToMove(ply) {

        // var mm = document.getElementById('pgn').outerHTML;
        // var regex = /(<([^>]+)>)/ig
        // var body = mm
        // var result = body.replace(regex, "");
        // moveList = result;
        // alert(moveList.length);
        //if (ply > moveList.length - 1) ply = moveList.length - 1;
        //game.reset();
        var engine = new Worker("/static/js/stockfish.js");
        console.log("GUI: uci");
        engine.postMessage("uci");
        console.log("GUI: ucinewgame");
        engine.postMessage("ucinewgame");


        // console.log(moveList.length - 1);
        var scoreList = [];
        var cursor = 0;
        var moveList = [];

        //alert(4);
        //goToMove(0);

        var player = 'w';
        var entirePGN = ''; // longer than current PGN when rewind buttons are clicked


        //goToMove(-1);
        var board;
        var game = new Chess(), // move validation, etc.
            statusEl = $('#status'),
            fenEl = $('#fen'),
            pgnEl = $('#pgn');
        pgnEll = $('#pgn1');
        var whiteSquareGrey = '#a9a9a9';
        var blackSquareGrey = '#696969';
        // true for when the engine is processing; ignore_mouse_events is always true if this is set (also during animations)
        var engineRunning = false;

        // don't let the user press buttons while other button clicks are still processing
        var board3D = ChessBoard3.webGLEnabled();

        if (!board3D) {
            swal("WebGL unsupported or disabled.", "Using a 2D board...");
            $('#dimensionBtn').remove();
        }

        var scoreGauge = $('#gauge').SonicGauge({
            label: 'WHITE\'S ADVANTAGE\n(centipawns)',
            start: {
                angle: -230,
                num: -2000
            },
            end: {
                angle: 50,
                num: 2000
            },
            markers: [{
                gap: 200,
                line: {
                    "width": 11,
                    "stroke": "none",
                    "fill": "#cccccc"
                },
                text: {
                    "space": -20,
                    "text-anchor": "middle",
                    "fill": "#cccccc",
                    "font-size": 8
                }
            }, {
                gap: 100,
                line: {
                    "width": 9,
                    "stroke": "none",
                    "fill": "#999999"
                }
            }, {
                gap: 50,
                line: {
                    "width": 7,
                    "stroke": "none",
                    "fill": "#888888"
                }
            }],
            animation_speed: 200,
            diameter: 250,
            style: {
                label: {
                    "font-size": 9,
                    fill: '#cccccc'
                },
                center: {
                    fill: 'r#f46a3a-#890b0b'
                },
                outline: {
                    fill: 'r#888888-#000000',
                    stroke: 'black',
                    'stroke-width': 1
                }
            }
        });


        function updateScoreGauge(score) {
            document.getElementById('setVal').value = score;

            var $p = $('.progress1');
            var $input = $('input');

            if (score >= 0) {

                if (score <= 2500 && score > 0) {

                    $p.css({
                        width: 180 + score + 'px',
                        backgroundPosition: score + 'px'
                    });
                }
            }
            if (score < 0) {

                if (score < 0 && score > -2500) {
                    if (score > -180) {
                        var tt = (180) + (score);


                    } else {
                        var t = (180) + (score);
                        var tt = 180 + (t);


                    }
                    $p.css({

                        width: tt + 'px',
                        backgroundPosition: tt + 'px'
                    });
                }
            }




            scoreGauge.SonicGauge('val', parseInt(score, 10));
        }




        function adjustBoardWidth() {
            var fudge = 250;
            var windowWidth = $(window).width();
            var windowHeight = $(window).height();
            var desiredBoardWidth = $('.one1').outerWidth(true);
            var desiredBoardHeight = windowHeight - $('#header').outerHeight(true) - $('#banner').outerHeight(true) - $('#footer').outerHeight(true) - fudge;

            var boardDiv = $('#board');
            if (board3D) {
                // Using chessboard3.js.
                // Adjust for 4:3 aspect ratio
                desiredBoardWidth &= 0xFFFC; // mod 4 = 0
                desiredBoardHeight -= (desiredBoardHeight % 3); // mod 3 = 0
                if (desiredBoardWidth * 0.75 > desiredBoardHeight) {
                    desiredBoardWidth = desiredBoardHeight * 4 / 3;
                }
                boardDiv.css('width', '80%');
                boardDiv.css('height', '100%');

            } else {
                // This is a chessboard.js board. Adjust for 1:1 aspect ratio
                desiredBoardWidth = Math.min(desiredBoardWidth, desiredBoardHeight);
                boardDiv.css('width', '80%');
                boardDiv.css('height', '65%');
            }
            if (board !== undefined) {
                board.resize();
            }
        }

        function fireEngine() {
            engineRunning = true;
            updateStatus();
            var currentScore;
            var msg = "position fen " + game.fen();
            //console.log("GUI: " + msg);
            engine.postMessage(msg);
            msg = 'go movetime ' + $('#moveTime').val();
            //console.log("GUI: " + msg);
            engine.postMessage(msg);
            engine.onmessage = function(event) {
                var line = event.data;

                //console.log("ENGINE: " + line);
                var best = parseBestMove(line);
                if (best !== undefined) {
                    var move = game.move(best);
                    moveList.push(move);
                    //console.log(moveList);



                    //var gameMoves = moveList.replace(/\[(.*?)\]/gm, '').replace(h.Result, '').trim();
                    //console.log(gameMoves);
                    if (currentScore !== undefined) {
                        if (scoreList.length > 0) {
                            scoreList.pop(); // remove the dummy score for the user's prior move
                            scoreList.push(currentScore); // Replace it with the engine's opinion
                        }
                        scoreList.push(currentScore); // engine's response
                    } else {
                        scoreList.push(0); // not expected
                    }
                    cursor++;
                    board.position(game.fen(), true);
                    engineRunning = false;
                    updateStatus();
                } else {
                    // Before the move gets here, the engine emits info responses with scores
                    var score = parseScore(line);
                    if (score !== undefined) {
                        if (player === 'w') {
                            score = -score; // convert from engine's score to white's score
                        }
                        updateScoreGauge(score);
                        currentScore = score;
                    }
                }
            };
        }



        function parseBestMove(line) {
            var match = line.match(/bestmove\s([a-h][1-8][a-h][1-8])(n|N|b|B|r|R|q|Q)?/);
            if (match) {
                var bestMove = match[1];
                var promotion = match[2];
                return {
                    from: bestMove.substring(0, 2),
                    to: bestMove.substring(2, 4),
                    promotion: promotion
                }
            }
        }

        function parseScore(line) {
            var match = line.match(/score\scp\s(-?\d+)/);
            if (match) {
                return match[1];
            } else {
                if (line.match(/mate\s-?\d/)) {
                    return 2500;
                }
            }
        }




        function updateStatus() {

            var status = '';

            var moveColor = 'White';
            if (game.turn() === 'b') {
                moveColor = 'Black';
            }

            if (game.game_over()) {

                if (game.in_checkmate()) {
                    status = moveColor + ' checkmated.';
                } else if (game.in_stalemate()) {
                    status = moveColor + " stalemated";
                } else if (game.insufficient_material()) {
                    status = "Draw (insufficient material)."
                } else if (game.in_threefold_repetition()) {
                    status = "Draw (threefold repetition)."
                } else if (game.in_draw()) {
                    status = "Game over (fifty move rule)."
                }
                swal({
                    title: "Game Over",
                    text: status,
                    type: 'info',
                    showCancelButton: false,
                    confirmButtonColor: "#DD6655",
                    onConfirmButtonText: 'OK',
                    closeOnConfirm: true
                });
                engineRunning = false;
            }

            // game still on
            else {
                if (player === 'w') {
                    status = "Computer playing Black; ";
                } else {
                    status = "Computer playing White; ";
                }
                status += moveColor + ' to move.';

                // check?
                if (game.in_check() === true) {
                    status += ' ' + moveColor + ' is in check.';
                }
            }

            fenEl.html(game.fen().replace(/ /g, '&nbsp;'));
            var currentPGN = game.pgn({
                max_width: 10,
                //newline_char: "<br>"
            });
            //console.log(entirePGN);
            var matches = entirePGN.lastIndexOf(currentPGN, 0) === 0;
            if (matches) {
                currentPGN += "<span>" + entirePGN.substring(currentPGN.length, entirePGN.length) + "</span>";
            } else {
                entirePGN = currentPGN;
            }
            // pgnEl.html(currentPGN);
            //currentPGN = currentPGN.trim();
            moveArray = [];

            var h = game.header();
            moveArray = moveArray.push(currentPGN);
            var gameMoves = currentPGN.replace(/\[(.*?)\]/gm, '').trim();
            console.log(gameMoves);
            moveArray = game.history();
            //format the moves so each one is individually identified, so it can be highlighted
            moveArray = gameMoves.split(/([0-9]+\.\s)/).filter(function(n) {
                return n;
            });
            for (var i = 0, l = moveArray.length; i < l; ++i) {
                var s = $.trim(moveArray[i]);
                if (!/^[0-9]+\.$/.test(s)) { //move numbers
                    m = s.split(/\s+/);
                    console.log(m);
                    for (var j = 0, ll = m.length; j < ll; ++j) {
                        m[j] = '<span class="gameMove' + (i + j - 1) + '"><a id="myLink" href="#" onclick="goToMove(' + (i + j - 1) + ');return false;">' + m[j] + '</a></span>';
                    }
                    s = m.join(' ');
                }
                moveArray[i] = s;
            }
            var gameData = '<div class="gameMoves">' + moveArray + '</div>';
            console.log("game moves ", gameData);



            pgnEl.html(gameData);


            if (engineRunning) {
                // status += ' Thinking...';
                status += ' ';
            }
            pgnEll.html(currentPGN);
            if (engineRunning) {
                // status += ' Thinking...';
                status += ' ';
            }
            statusEl.html(status);
        };




        // Set up chessboard
        var onDrop = function(source, target) {

            if (engineRunning) {
                return 'snapback';
            }

            if (board.hasOwnProperty('removeGreySquares') && typeof board.removeGreySquares === 'function') {
                board.removeGreySquares();
            }

            // see if the move is legal
            var move = game.move({
                from: source,
                to: target,
                promotion: 'q' //$("#promotion").val()
            });



            // illegal move
            if (move === null) return 'snapback';
            // highlight black's move

            removeHighlights('white')
            $board.find('.square-' + source).addClass('highlight-white')
            $board.find('.square-' + target).addClass('highlight-white')

            if (cursor === 0) {
                console.log("GUI: ucinewgame");
                engine.postMessage("ucinewgame");
            }
            moveList = moveList.slice(0, cursor);
            scoreList = scoreList.slice(0, cursor);
            moveList.push(move);
            // User just made a move- add a dummy score for now. We will correct this element once we hear from the engine
            scoreList.push(scoreList.length === 0 ? 0 : scoreList[scoreList.length - 1]);
            cursor = moveList.length;
            //console.log(cursor);
        };


        var $board = $('#board')
        var squareClass = 'square-55d63'

        function removeHighlights(color) {
            $board.find('.' + squareClass)
                .removeClass('highlight-' + color)
        }
        // update the board position after the piece snap
        // for castling, en passant, pawn promotion
        var onSnapEnd = function() {

            if (!game.game_over() && game.turn() !== player) {
                fireEngine();
            }

        };

        var squareToHighlight = null

        function onMouseoverSquare(square, piece) {
            // get list of possible moves for this square
            var moves = game.moves({
                square: square,
                verbose: true
            })

            // exit if there are no moves available for this square
            if (moves.length === 0) {
                ondragpostion(square);
            }

            // highlight the square they moused over
            greySquare(square)

            // highlight the possible squares for this piece
            for (var i = 0; i < moves.length; i++) {
                board.addArrowAnnotation(square, moves[i].to)
                greySquare(moves[i].to)
            }
        }

        $('input[type="checkbox"][name="btn_drawar"]').change(function() {

            if (this.checked) {

                $('#imageView').css('display', 'initial');
                $('#imageTemp').css('display', 'initial');
                $('#imageView').css('z-index', 1);
                $('#imageTemp').css('z-index', 11);
                $('#board').css('z-index', -1111);
            } else {

                $('#imageView').css('display', 'none');
                $('#imageView').css('z-index', -1);
                $('#imageTemp').css('z-index', -11);
                $('#board').css('z-index', 1111);
            }
        });

        function ondragpostion(square) {
            //board.addArrowAnnotation(square, "h5"); 
        }

        function onMouseoutSquare(square, piece) {
            board.clearAnnotation()
            removeGreySquares()
        }

        function removeGreySquares() {
            $('#board .square-55d63').css('background', '')
        }

        function greySquare(square) {
            // alert(square);
            var square = $('#board .square-' + square)

            var background = whiteSquareGrey
            if (square.hasClass('black-3c85d')) {
                background = blackSquareGrey
            }

            square.css('background', background)


        }



        function onMoveEnd() {
            $board.find('.square-' + squareToHighlight)
                .addClass('highlight-black')
        }

        function createBoard(pieceSet, args, args1, args2) {
            // alert(pieceSet+"->"+args);
            var cfg = {

                cameraControls: true,
                draggable: true,
                position: 'r1bqkb1r/ppp2ppp/2n2n2/4p3/8/2pPPPPP/PP6/RNBQKBNR w KQkq - 0 7',
                onDrop: onDrop,
                onMouseoutSquare: onMouseoutSquare,
                onMouseoverSquare: onMouseoverSquare,
                onSnapEnd: onSnapEnd,
                onMoveEnd: onMoveEnd,
                overlay: true
            };


            //goToMove(moveList.length - 1);
            // if (board3D) {
            //     if (pieceSet) {
            //         if (pieceSet === 'minions') {
            //             cfg.whitePieceColor = 0xFFFF00;
            //             cfg.blackPieceColor = 0xCC00CC;
            //             cfg.lightSquareColor = 0x888888;
            //             cfg.darkSquareColor = 0x666666;
            //         }
            //         cfg.pieceSet = '/static/assets/chesspieces/' + pieceSet + '/{piece}.json';
            //     }
            //     return new ChessBoard3('board', cfg);
            //   } else {

            if (args == '2D') {
                if (args1 == 'piece') {
                    var selectedVal = $("#board-style option:selected").val();
                    if (selectedVal == 'aluminium') {

                        // cfg.boardTheme = ["#6fadd4", "#d0ceca"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/ab.png')", "url('/static/img/chesspieces/board/aw.png')", "url('/static/img/chesspieces/board/ab.png')"]

                        });


                    }
                    if (selectedVal == 'cherry') {

                        //cfg.boardTheme = ["#521b01", "#b45119"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/cherry1.png')", "url('/static/img/chesspieces/board/cherry2.png')", "url('/static/img/chesspieces/board/cherry2.png')"]

                        });
                    }
                    if (selectedVal == 'lapis') {

                        //cfg.boardTheme = ["#244251", "#c9b46b"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/wb.png')", "url('/static/img/chesspieces/board/ww.png')", "url('/static/img/chesspieces/board/wb.png')"]

                        });
                    }
                    if (selectedVal == 'marble') {

                        //cfg.boardTheme = ["#bb886e", "#e9d2b7"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/marble1.png')", "url('/static/img/chesspieces/board/marble2.png')", "url('/static/img/chesspieces/board/marble1.png')"]

                        });
                    }
                    if (selectedVal == 'sand') {

                        //cfg.boardTheme = ["#c8a97d", "#fdedb7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/sand1.png')", "url('/static/img/chesspieces/board/sand2.png')", "url('/static/img/chesspieces/board/sand1.png')"],
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png'
                        });
                    }
                    if (selectedVal == 'slate') {

                        //cfg.boardTheme = ["#8c8c8c", "#c9c9c9"];
                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/slate1.png')", "url('/static/img/chesspieces/board/slate2.png')", "url('/static/img/chesspieces/board/slate2.png')"]

                        });
                    } else {
                        //cfg.boardTheme = ["#ae6c37", "#d4b171"];#244251", "#c9b46b

                        return new ChessBoard('board', {
                            pieceTheme: '/static/img/chesspieces/' + pieceSet + '/{piece}.png',

                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/lapis/lapis1.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')"]


                        });
                    }



                    //cfg.pieceTheme = '/static/img/chesspieces/' + pieceSet + '/{piece}.png';


                    //return new ChessBoard('board', cfg);
                }
                if (args1 == 'board') {
                    if (pieceSet == 'aluminium') {
                        // cfg.boardTheme = ["#6fadd4", "#d0ceca"];

                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/ab.png')", "url('/static/img/chesspieces/board/aw.png')", "url('/static/img/chesspieces/board/ab.png')"]

                        });

                    }
                    if (pieceSet == 'cherry') {

                        //cfg.boardTheme = ["#521b01", "#b45119"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/cherry1.png')", "url('/static/img/chesspieces/board/cherry2.png')", "url('/static/img/chesspieces/board/cherry2.png')"]

                        });
                    }
                    if (pieceSet == 'lapis') {

                        //cfg.boardTheme = ["#244251", "#c9b46b"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/wb.png')", "url('/static/img/chesspieces/board/ww.png')", "url('/static/img/chesspieces/board/wb.png')"]

                        });
                    }
                    if (pieceSet == 'marble') {

                        //cfg.boardTheme = ["#bb886e", "#e9d2b7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/marble1.png')", "url('/static/img/chesspieces/board/marble2.png')", "url('/static/img/chesspieces/board/marble1.png')"]

                        });
                    }
                    if (pieceSet == 'sand') {

                        //cfg.boardTheme = ["#c8a97d", "#fdedb7"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/sand1.png')", "url('/static/img/chesspieces/board/sand2.png')", "url('/static/img/chesspieces/board/sand1.png')"]

                        });
                    }
                    if (pieceSet == 'slate') {

                        //cfg.boardTheme = ["#8c8c8c", "#c9c9c9"];
                        return new ChessBoard('board', {
                            draggable: true,
                            position: 'start',
                            onDrop: onDrop,
                            onSnapEnd: onSnapEnd,
                            boardTheme: ["url('/static/img/chesspieces/board/slate1.png')", "url('/static/img/chesspieces/board/slate2.png')", "url('/static/img/chesspieces/board/slate2.png')"]

                        });
                    }
                    return new ChessBoard('board', cfg);
                }

            } else {
                //cfg.boardTheme = ["#ae6c37", "#d4b171"];#244251", "#c9b46b

                return new ChessBoard('board', {
                    draggable: true,
                    position: 'start',
                    onDrop: onDrop,
                    onSnapEnd: onSnapEnd,
                    boardTheme: ["url('/static/img/chesspieces/board/lapis/lapis1.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')", "url('/static/img/chesspieces/board/lapis/lapis2.png')"]


                });
            }

            // }
        }


        adjustBoardWidth();
        board = createBoard();

        $(window).resize(function() {
            adjustBoardWidth();
        });
        //console.log(board.position());






        // Set up buttons
        $('#startBtn').on('click', function() {
            var cursorStart = 0;
            if (player === 'b') {
                cursorStart = 1;
            }
            while (cursor > cursorStart) {
                game.undo();
                cursor--;
            }
            updateScoreGauge(0);
            board.position(game.fen());
            updateStatus();
        });
        $('#backBtn').on('click', function() {
            if (cursor > 0) {
                cursor--;
                game.undo();
                board.position(game.fen());
                var score = cursor === 0 ? 0 : scoreList[cursor - 1];
                updateScoreGauge(score);
                updateStatus();
            }
        });
        $('#forwardBtn').on('click', function() {
            if (cursor < moveList.length) {
                game.move(moveList[cursor]);
                var score = scoreList[cursor];
                updateScoreGauge(score);
                board.position(game.fen());
                cursor++;
                updateStatus();
            }
        });




        var cursorStart1 = 0;
        var pause_value = "play";
        $('#playBtn').on('click', function() {
            pause_value = "play";
            //cursorStart=0;
            while (cursor > cursorStart1) {
                game.undo();
                cursor--;
            }
            updateScoreGauge(0);
            board.position(game.fen());
            updateStatus();
            if (pause_value == "play") {
                play();
            } else {
                if (pause_value == "pause") {
                    stop();
                } else {
                    return;
                }
            }

        });

        function play() {
            var k = moveList.length;
            document.getElementById('movecount').value = k;
            // var pause = document.getElementById('playcount').value;
            var me = this;
            var delay = 1000;
            var timerId = null;
            var moveId = 0;
            for (i = k; i > 0; i--) {
                document.getElementById('movecount').value = i;
                setTimeout(function timer() {
                    if (pause_value == 'pause') {

                    } else {

                        game.move(moveList[cursor]);
                        var score = scoreList[cursor];
                        board.position(game.fen());
                        cursor++;
                        updateStatus();
                        updateScoreGauge(score);
                    }

                }, i * delay);
                cursorStart1++;

            }


        }
        $('#pause').on('click', function() {
            pause_value = "pause";
            document.getElementById("board").disabled = true;
            if (pause_value == "play") {
                play();
            } else {
                //pause_value="play";
            }

        });

        function stop() {}
        $('#endBtn').on('click', function() {
            while (cursor < moveList.length) {
                game.move(moveList[cursor++]);
            }
            board.position(game.fen());
            updateScoreGauge(scoreList.length == 0 ? 0 : scoreList[cursor - 1]);
            updateStatus();
        });
        $('#hintBtn').on('click', function() {
            if (game.turn() === player) {
                engineRunning = true;
                var msg = "position fen " + game.fen();
                console.log("GUI: " + msg);
                engine.postMessage(msg);
                msg = 'go movetime ' + $('#moveTime').val();
                console.log(msg);
                engine.postMessage(msg);
                engine.onmessage = function(event) {
                    console.log("ENGINE: " + event.data);
                    var best = parseBestMove(event.data);
                    if (best !== undefined) {
                        var currentFEN = game.fen();
                        game.move(best);
                        var hintedFEN = game.fen();
                        game.undo();
                        board.position(hintedFEN, true);
                        // give them a second to look before sliding the piece back
                        setTimeout(function() {
                            board.position(currentFEN, true);
                            engineRunning = false;
                        }, 1000); // give them a second to look
                    }
                }
            }
        });
        $('#flipBtn').on('click', function() {
            if (game.game_over()) {
                return;
            }
            board.flip(); //wheeee!
            if (player === 'w') {
                player = 'b';
            } else {
                player = 'w';
            }
            updateStatus();
            setTimeout(fireEngine, 1000);
        });

        $('#dimensionBtn').on('click', function() {
            var dimBtn = $("#dimensionBtn");
            var sel = document.getElementById('dimensionBtn').value;
            dimBtn.prop('disabled', true);
            var position = board.position();
            var orientation = board.orientation();
            board.destroy();
            board3D = !board3D;
            adjustBoardWidth();
            if (sel == '3D') {

                dimBtn.val(board3D ? '3D' : '2D');
                setTimeout(function() {

                    board = createBoard($('#piecesMenu').val(), sel);
                    board.orientation(orientation);
                    board.position(position);
                    $("#dimensionBtn").prop('disabled', false);
                });
            }
            if (sel == '2D') {
                setTimeout(function() {

                    board = createBoard($('#piece-style').val(), sel);
                    console.log(board);
                    board.orientation(orientation);
                    board.position(position);
                    $("#dimensionBtn").prop('disabled', false);

                });
            }


        });


        $("#setFEN").on('click', function(e) {
            swal({
                title: "SET FEN",
                text: "Enter a FEN position below:",
                type: "input",
                inputType: "text",
                showCancelButton: true,
                closeOnConfirm: false
            }, function(fen) {
                if (fen === false) {
                    return; //cancel
                }
                fen = fen.trim();
                console.log(fen);
                var fenCheck = game.validate_fen(fen);
                console.log("valid: " + fenCheck.valid);
                if (fenCheck.valid) {
                    game = new Chess(fen);
                    console.log("GUI: ucinewgame");
                    engine.postMessage('ucinewgame');
                    console.log("GUI: position fen " + fen);
                    engine.postMessage('position fen ' + fen);
                    board.position(fen);
                    fenEl.val(fen);
                    pgnEl.empty();
                    pgnEll.empty();
                    updateStatus();
                    swal("Success", "FEN parsed successfully.", "success");
                } else {
                    console.log(fenCheck.error);
                    swal.showInputError("ERROR: " + fenCheck.error);
                    return false;
                }
            });
        });

        $("#setPGN").on('click', (function(e) {
            swal({
                title: "SET PGN",
                text: "Enter a game PGN below:",
                type: "input",

                showCancelButton: true,
                closeOnConfirm: false
            }, function(pgn) {
                if (pgn === false) {
                    return; // cancel
                }
                pgn = pgn.trim();
                console.log(pgn);
                var pgnGame = new Chess();
                if (pgnGame.load_pgn(pgn)) {
                    game = pgnGame;
                    var fen = game.fen();
                    console.log("GUI: ucinewgame");
                    engine.postMessage('ucinewgame');
                    console.log("GUI: position fen " + fen);
                    engine.postMessage('position fen ' + game.fen());
                    board.position(fen, false);
                    fenEl.val(game.fen());
                    pgnEl.empty();
                    pgnEll.empty();
                    moveList = game.history();
                    scoreList = [];
                    for (var i = 0; i < moveList.length; i++) {
                        scoreList.push(0);
                    }
                    cursor = moveList.length;
                    updateStatus();
                    swal("Success", "PGN parsed successfully.", "success");
                } else {
                    swal.showInputError("PGN not valid.");
                    return false;
                }
            });
        }));

        $("#resetBtn").on('click', function(e) {
            player = 'w';
            game = new Chess();
            fenEl.empty();
            pgnEl.empty();
            pgnEll.empty();
            largestPGN = '';
            moveList = [];
            scoreList = [];
            cursor = 0;
            board.start();
            board.orientation('white');
            console.log("GUI: ucinewgame");
            engine.postMessage('ucinewgame');
            updateScoreGauge(0);
        });

        $("#engineMenu").change(function() {
            console.log($("#engineMenu").val());
            if (engine) {
                var jsURL = $("#engineMenu").val();
                engine.terminate();
                engine = new Worker(jsURL);
                console.log("GUI: uci");
                engine.postMessage('uci');
                console.log("GUI: ucinewgame");
                engine.postMessage('ucinewgame');
                updateScoreGauge(0); // they each act a little differently
                if (jsURL.match(/p4wn/)) {
                    swal('Using the tiny p4wn engine, which plays at an amateur level.');
                } else if (jsURL.match(/lozza/)) {
                    swal('Using Lozza engine by Colin Jerkins, estimated rating 2340.')
                } else if (jsURL.match(/stockfish/)) {
                    swal("Using stockfish engine, estimated rating > 3000.");
                }
            }
        });

        $('#piecesMenu').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#piecesMenu').val(), '3D', '');
            board.position(fen);
            adjustBoardWidth();
        });

        $('#piece-style').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#piece-style').val(), '2D', 'piece');
            board.position(fen);
            adjustBoardWidth();
        });
        $('#board-style').change(function() {
            var fen = board.position();
            board.destroy();
            board = createBoard($('#board-style').val(), '2D', 'board');
            board.position(fen);
            adjustBoardWidth();
        });

        updateStatus();
        alert(moveList);
        if (ply > moveList.length - 1) ply = moveList.length - 1;
        game.reset();
        for (var i = 0; i <= ply; i++) {
            game.move(moveList[i]);
            //board.position(game.fen());
        }
        cursor = i - 1;
        board.position(game.fen());
    }
</script>
{% endblock content %}